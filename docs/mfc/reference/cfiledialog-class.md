---
title: CFileDialog 类
ms.date: 11/04/2016
f1_keywords:
- CFileDialog
- AFXDLGS/CFileDialog
- AFXDLGS/CFileDialog::CFileDialog
- AFXDLGS/CFileDialog::AddCheckButton
- AFXDLGS/CFileDialog::AddComboBox
- AFXDLGS/CFileDialog::AddControlItem
- AFXDLGS/CFileDialog::AddEditBox
- AFXDLGS/CFileDialog::AddMenu
- AFXDLGS/CFileDialog::AddPlace
- AFXDLGS/CFileDialog::AddPushButton
- AFXDLGS/CFileDialog::AddRadioButtonList
- AFXDLGS/CFileDialog::AddSeparator
- AFXDLGS/CFileDialog::AddText
- AFXDLGS/CFileDialog::ApplyOFNToShellDialog
- AFXDLGS/CFileDialog::DoModal
- AFXDLGS/CFileDialog::EnableOpenDropDown
- AFXDLGS/CFileDialog::EndVisualGroup
- AFXDLGS/CFileDialog::GetCheckButtonState
- AFXDLGS/CFileDialog::GetControlItemState
- AFXDLGS/CFileDialog::GetControlState
- AFXDLGS/CFileDialog::GetEditBoxText
- AFXDLGS/CFileDialog::GetFileExt
- AFXDLGS/CFileDialog::GetFileName
- AFXDLGS/CFileDialog::GetFileTitle
- AFXDLGS/CFileDialog::GetFolderPath
- AFXDLGS/CFileDialog::GetIFileDialogCustomize
- AFXDLGS/CFileDialog::GetIFileOpenDialog
- AFXDLGS/CFileDialog::GetIFileSaveDialog
- AFXDLGS/CFileDialog::GetNextPathName
- AFXDLGS/CFileDialog::GetOFN
- AFXDLGS/CFileDialog::GetPathName
- AFXDLGS/CFileDialog::GetReadOnlyPref
- AFXDLGS/CFileDialog::GetResult
- AFXDLGS/CFileDialog::GetResults
- AFXDLGS/CFileDialog::GetSelectedControlItem
- AFXDLGS/CFileDialog::GetStartPosition
- AFXDLGS/CFileDialog::HideControl
- AFXDLGS/CFileDialog::IsPickFoldersMode
- AFXDLGS/CFileDialog::MakeProminent
- AFXDLGS/CFileDialog::RemoveControlItem
- AFXDLGS/CFileDialog::SetCheckButtonState
- AFXDLGS/CFileDialog::SetControlItemState
- AFXDLGS/CFileDialog::SetControlItemText
- AFXDLGS/CFileDialog::SetControlLabel
- AFXDLGS/CFileDialog::SetControlState
- AFXDLGS/CFileDialog::SetControlText
- AFXDLGS/CFileDialog::SetDefExt
- AFXDLGS/CFileDialog::SetEditBoxText
- AFXDLGS/CFileDialog::SetProperties
- AFXDLGS/CFileDialog::SetSelectedControlItem
- AFXDLGS/CFileDialog::SetTemplate
- AFXDLGS/CFileDialog::StartVisualGroup
- AFXDLGS/CFileDialog::UpdateOFNFromShellDialog
- AFXDLGS/CFileDialog::OnButtonClicked
- AFXDLGS/CFileDialog::OnCheckButtonToggled
- AFXDLGS/CFileDialog::OnControlActivating
- AFXDLGS/CFileDialog::OnFileNameChange
- AFXDLGS/CFileDialog::OnFileNameOK
- AFXDLGS/CFileDialog::OnFolderChange
- AFXDLGS/CFileDialog::OnInitDone
- AFXDLGS/CFileDialog::OnItemSelected
- AFXDLGS/CFileDialog::OnLBSelChangedNotify
- AFXDLGS/CFileDialog::OnShareViolation
- AFXDLGS/CFileDialog::OnTypeChange
- AFXDLGS/CFileDialog::m_ofn
helpviewer_keywords:
- CFileDialog [MFC], CFileDialog
- CFileDialog [MFC], AddCheckButton
- CFileDialog [MFC], AddComboBox
- CFileDialog [MFC], AddControlItem
- CFileDialog [MFC], AddEditBox
- CFileDialog [MFC], AddMenu
- CFileDialog [MFC], AddPlace
- CFileDialog [MFC], AddPushButton
- CFileDialog [MFC], AddRadioButtonList
- CFileDialog [MFC], AddSeparator
- CFileDialog [MFC], AddText
- CFileDialog [MFC], ApplyOFNToShellDialog
- CFileDialog [MFC], DoModal
- CFileDialog [MFC], EnableOpenDropDown
- CFileDialog [MFC], EndVisualGroup
- CFileDialog [MFC], GetCheckButtonState
- CFileDialog [MFC], GetControlItemState
- CFileDialog [MFC], GetControlState
- CFileDialog [MFC], GetEditBoxText
- CFileDialog [MFC], GetFileExt
- CFileDialog [MFC], GetFileName
- CFileDialog [MFC], GetFileTitle
- CFileDialog [MFC], GetFolderPath
- CFileDialog [MFC], GetIFileDialogCustomize
- CFileDialog [MFC], GetIFileOpenDialog
- CFileDialog [MFC], GetIFileSaveDialog
- CFileDialog [MFC], GetNextPathName
- CFileDialog [MFC], GetOFN
- CFileDialog [MFC], GetPathName
- CFileDialog [MFC], GetReadOnlyPref
- CFileDialog [MFC], GetResult
- CFileDialog [MFC], GetResults
- CFileDialog [MFC], GetSelectedControlItem
- CFileDialog [MFC], GetStartPosition
- CFileDialog [MFC], HideControl
- CFileDialog [MFC], IsPickFoldersMode
- CFileDialog [MFC], MakeProminent
- CFileDialog [MFC], RemoveControlItem
- CFileDialog [MFC], SetCheckButtonState
- CFileDialog [MFC], SetControlItemState
- CFileDialog [MFC], SetControlItemText
- CFileDialog [MFC], SetControlLabel
- CFileDialog [MFC], SetControlState
- CFileDialog [MFC], SetControlText
- CFileDialog [MFC], SetDefExt
- CFileDialog [MFC], SetEditBoxText
- CFileDialog [MFC], SetProperties
- CFileDialog [MFC], SetSelectedControlItem
- CFileDialog [MFC], SetTemplate
- CFileDialog [MFC], StartVisualGroup
- CFileDialog [MFC], UpdateOFNFromShellDialog
- CFileDialog [MFC], OnButtonClicked
- CFileDialog [MFC], OnCheckButtonToggled
- CFileDialog [MFC], OnControlActivating
- CFileDialog [MFC], OnFileNameChange
- CFileDialog [MFC], OnFileNameOK
- CFileDialog [MFC], OnFolderChange
- CFileDialog [MFC], OnInitDone
- CFileDialog [MFC], OnItemSelected
- CFileDialog [MFC], OnLBSelChangedNotify
- CFileDialog [MFC], OnShareViolation
- CFileDialog [MFC], OnTypeChange
- CFileDialog [MFC], m_ofn
ms.assetid: fda4fd3c-08b8-4ce0-8e9d-7bab23f8c6c0
ms.openlocfilehash: c301766b64af7fc1523b39adad91d9b52a5e88f7
ms.sourcegitcommit: fcb48824f9ca24b1f8bd37d647a4d592de1cc925
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/15/2019
ms.locfileid: "69506593"
---
# <a name="cfiledialog-class"></a>CFileDialog 类

封装用于文件打开或文件保存操作的通用对话框。

## <a name="syntax"></a>语法

```
class CFileDialog : public CCommonDialog
```

## <a name="members"></a>成员

### <a name="public-constructors"></a>公共构造函数

|名称|描述|
|----------|-----------------|
|[CFileDialog::CFileDialog](#cfiledialog)|构造 `CFileDialog` 对象。|

### <a name="public-methods"></a>公共方法

|名称|描述|
|----------|-----------------|
|[CFileDialog::AddCheckButton](#addcheckbutton)|向对话框添加复选按钮。|
|[CFileDialog::AddComboBox](#addcombobox)|向对话框中添加组合框。|
|[CFileDialog::AddControlItem](#addcontrolitem)|将项添加到对话框中的容器控件。|
|[CFileDialog::AddEditBox](#addeditbox)|将编辑框添加到对话框中。|
|[CFileDialog::AddMenu](#addmenu)|将菜单添加到对话框。|
|[CFileDialog::AddPlace](#addplace)|已重载。 将文件夹添加到可供用户打开或保存项目的位置列表中。|
|[CFileDialog::AddPushButton](#addpushbutton)|向对话框添加一个按钮。|
|[CFileDialog::AddRadioButtonList](#addradiobuttonlist)|将选项按钮 (也称为单选按钮) 组添加到对话框。|
|[CFileDialog::AddSeparator](#addseparator)|将分隔符添加到对话框。|
|[CFileDialog::AddText](#addtext)|向对话框添加文本内容。|
|[CFileDialog::ApplyOFNToShellDialog](#applyofntoshelldialog)|更新的`CFileDialog`状态以匹配存储`m_ofn`在成员变量中的参数和标志。|
|[CFileDialog::DoModal](#domodal)|显示对话框, 并允许用户进行选择。|
|[CFileDialog::EnableOpenDropDown](#enableopendropdown)|启用对话框中的 "**打开**" 或 "**保存**" 按钮上的下拉列表。|
|[CFileDialog::EndVisualGroup](#endvisualgroup)|停止向对话框中的可视组添加元素。|
|[CFileDialog::GetCheckButtonState](#getcheckbuttonstate)|获取对话框中选中按钮 (复选框) 的当前状态。|
|[CFileDialog::GetControlItemState](#getcontrolitemstate)|获取在对话框中找到的容器控件中项的当前状态。|
|[CFileDialog::GetControlState](#getcontrolstate)|获取给定控件的当前可见性和已启用状态。|
|[CFileDialog::GetEditBoxText](#geteditboxtext)|获取编辑框控件中的当前文本。|
|[CFileDialog::GetFileExt](#getfileext)|返回所选文件的扩展名。|
|[CFileDialog::GetFileName](#getfilename)|返回选定文件的文件名。|
|[CFileDialog::GetFileTitle](#getfiletitle)|返回选定文件的标题。|
|[CFileDialog::GetFolderPath](#getfolderpath)|为资源管理器样式的 "**打开**" 或 "**另存为**公用" 对话框检索当前打开的文件夹或目录的路径。|
|[CFileDialog::GetIFileDialogCustomize](#getifiledialogcustomize)|检索自定义`CFileDialog`对象的内部 COM 对象。|
|[CFileDialog::GetIFileOpenDialog](#getifileopendialog)|检索用作 "**打开**文件" 对话框`CFileDialog`的的内部 COM 对象。|
|[CFileDialog::GetIFileSaveDialog](#getifilesavedialog)|检索用作 "**保存**文件" 对话框`CFileDialog`的的内部 COM 对象。|
|[CFileDialog::GetNextPathName](#getnextpathname)|返回下一个所选文件的完整路径。|
|[CFileDialog::GetOFN](#getofn)|检索对象`CFileDialog`的结构。 `OPENFILENAME`|
|[CFileDialog::GetPathName](#getpathname)|返回所选文件的完整路径。|
|[CFileDialog::GetReadOnlyPref](#getreadonlypref)|返回所选文件的只读状态。|
|[CFileDialog::GetResult](#getresult)|获取用户在对话框中所做的选择。|
|[CFileDialog::GetResults](#getresults)|获取允许多重选择的对话框中的用户选择。|
|[CFileDialog::GetSelectedControlItem](#getselectedcontrolitem)|获取对话框中指定容器控件的特定项。|
|[CFileDialog::GetStartPosition](#getstartposition)|返回文件名列表中第一个元素的位置。|
|[CFileDialog::HideControl](#hidecontrol)|在资源管理器样式的 "**打开**" 或 "**另存为**公用" 对话框中隐藏指定的控件。|
|[CFileDialog::IsPickFoldersMode](#ispickfoldersmode)|确定当前对话框是否处于文件夹选取器模式。|
|[CFileDialog::MakeProminent](#makeprominent)|将控件放置在对话框中, 使其与其他添加的控件相比较。|
|[CFileDialog::RemoveControlItem](#removecontrolitem)|删除对话框中容器控件中的项。|
|[CFileDialog::SetCheckButtonState](#setcheckbuttonstate)|设置对话框中选中按钮 (复选框) 的当前状态。|
|[CFileDialog::SetControlItemState](#setcontrolitemstate)|设置在对话框中找到的容器控件中某项的当前状态。|
|[CFileDialog::SetControlItemText](#setcontrolitemtext)|设置控件项的文本。 例如, 单选按钮或菜单中的项的文本。|
|[CFileDialog::SetControlLabel](#setcontrollabel)|设置与控件关联的文本, 例如按钮文本或编辑框标签。|
|[CFileDialog::SetControlState](#setcontrolstate)|设置给定控件的当前可见性和已启用状态。|
|[CFileDialog::SetControlText](#setcontroltext)|在资源管理器样式的 "**打开**" 或 "**另存为**公用" 对话框中设置指定控件的文本。|
|[CFileDialog::SetDefExt](#setdefext)|为资源管理器样式的 "**打开**" 或 "**另存为**公用" 对话框设置默认文件扩展名。|
|[CFileDialog::SetEditBoxText](#seteditboxtext)|设置编辑框控件中的当前文本。|
|[CFileDialog::SetProperties](#setproperties)|提供一个属性存储，它定义将默认值用于正在保存的项。|
|[CFileDialog::SetSelectedControlItem](#setselectedcontrolitem)|设置选项按钮组或对话框中的组合框中特定项的选定状态。|
|[CFileDialog::SetTemplate](#settemplate)|设置`CFileDialog`对象的对话框模板。|
|[CFileDialog::StartVisualGroup](#startvisualgroup)|在对话框中声明一个视觉对象组。 对任何 "add" 方法的后续调用都会向此组添加这些元素。|
|[CFileDialog::UpdateOFNFromShellDialog](#updateofnfromshelldialog)|更新存储在`m_ofn`成员变量中的数据, 使其与文件对话框的当前状态匹配。|

### <a name="protected-methods"></a>受保护的方法

|名称|描述|
|----------|-----------------|
|[CFileDialog::OnButtonClicked](#onbuttonclicked)|在单击按钮时调用。|
|[CFileDialog::OnCheckButtonToggled](#oncheckbuttontoggled)|选中/取消选中复选框时调用。|
|[CFileDialog::OnControlActivating](#oncontrolactivating)|当控件处于活动状态时调用。|
|[CFileDialog::OnFileNameChange](#onfilenamechange)|处理 WM_NOTIFY CDN_SELCHANGE 消息。|
|[CFileDialog::OnFileNameOK](#onfilenameok)|验证在对话框中输入的文件名。|
|[CFileDialog::OnFolderChange](#onfolderchange)|处理 WM_NOTIFY CDN_FOLDERCHANGE 消息。|
|[CFileDialog::OnInitDone](#oninitdone)|处理 WM_NOTIFY CDN_INITDONE 消息。|
|[CFileDialog::OnItemSelected](#onitemselected)|在选择容器项时调用。|
|[CFileDialog::OnLBSelChangedNotify](#onlbselchangednotify)|允许在文件选择更改时执行自定义操作。|
|[CFileDialog::OnShareViolation](#onshareviolation)|处理共享冲突。|
|[CFileDialog::OnTypeChange](#ontypechange)|处理 WM_NOTIFY CDN_TYPECHANGE 消息。|

### <a name="public-data-members"></a>公共数据成员

|名称|描述|
|----------|-----------------|
|[CFileDialog::m_ofn](#m_ofn)|Windows `OPENFILENAME`结构。 提供对基本文件对话框参数的访问。|

## <a name="remarks"></a>备注

使用 "常用文件" 对话框, 您可以实现文件选择对话框 (例如, "**打开文件**" 和 "**另存为**"), 这种方式与 Windows 标准一致。

您可以按`CFileDialog`所提供的构造函数使用 as, 也可以从`CFileDialog`派生您自己的对话框类, 并编写一个构造函数来满足您的需求。 在这两种情况下, 这些对话框的行为类似于标准 MFC 对话框, 因为它们派生自[CCommonDialog 类](../../mfc/reference/ccommondialog-class.md)。 `CFileDialog`依赖于 COMMDLG。DLL 文件。

和 windows Vista 或更高版本的`CFileDialog`外观和功能都不同于 windows 的早期版本。 如果在`CFileDialog` Windows vista 或更高版本中编译并运行某个程序, 则默认情况下会自动使用新的 Windows Vista 或更高版本, 而不更改代码。 使用构造函数中的*bVistaStyle*参数手动重写此自动更新。 自动更新的例外是自定义对话框。 它们不会转换为新样式。 有关构造函数的详细信息, 请参阅[CFileDialog:: CFileDialog](#cfiledialog)。

> [!NOTE]
>  当你使用`CFileDialog`时, 控件 ID 系统在 windows Vista 或更高版本中不同于 windows 的早期版本。 你必须在代码中更新`CFileDialog`对控件的所有引用, 然后才能从早期版本的 Windows 移植你的项目。

Windows `CFileDialog` Vista 或更高版本不支持某些方法。 有关方法是否受支持的信息, 请查看单个方法主题。 此外, 在 Windows Vista 或更高版本下不支持以下继承函数:

- [CDialog::OnInitDialog](../../mfc/reference/cdialog-class.md#oninitdialog)

- [CDialog::OnSetFont](../../mfc/reference/cdialog-class.md#onsetfont)

`CFileDialog`类的 windows 消息根据你所使用的操作系统的不同而异。 例如, Windows XP 不支持`CFileDialog`类的[CDialog:: OnCancel](../../mfc/reference/cdialog-class.md#oncancel)和[CDialog:: OnOK](../../mfc/reference/cdialog-class.md#onok) 。 但是, Windows Vista 和更高版本的操作系统支持它们。 有关生成的不同消息及其接收顺序的详细信息, 请参阅[CFileDialog 示例:日志记录事件](../../overview/visual-cpp-samples.md)顺序。

若要使用`CFileDialog`对象, 请先`CFileDialog`使用构造函数创建对象。 构造对话框后, 您可以设置或修改[CFileDialog:: m_ofn](#m_ofn)结构中的任何值以初始化对话框控件的值或状态。 结构的类型`OPENFILENAME`为。 `m_ofn` 有关详细信息, 请参阅 Windows SDK 中的[OPENFILENAME](/windows/win32/api/commdlg/ns-commdlg-openfilenamew)结构。

初始化对话框控件后, 调用[CFileDialog::D omodal](#domodal)方法以显示对话框, 以便用户可以键入路径和文件名。 `DoModal`返回用户是否单击了 "确定" (IDOK) 或 "取消" (IDCANCEL) 按钮。 如果`DoModal`返回 IDOK, 则可以使用其中一个`CFileDialog`公共成员函数来检索用户输入的信息。

> [!NOTE]
> 在 Windows Vista 或更高版本下, 多个对[IFileDialog:: SetFileTypes](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ifiledialog-setfiletypes)的调用会导致错误。 对任何实例`CFileDialog`的`SetFileTypes`第二次调用将在 Windows Vista 或更高版本中返回 E_UNEXPECTED。 一些`CFileDialog`方法函数调用`SetFileTypes`。 例如, 对的同一实例`CFileDialog::DoModal` `CFileDialog`的两个调用会生成[断言](diagnostic-services.md#assert)。

`CFileDialog`包含多个受保护的成员, 这些成员可用于对共享冲突、文件名验证和列表框更改通知进行自定义处理。 这些受保护的成员是大多数应用程序不需要使用的回调函数, 因为默认处理会自动执行。 这些函数的消息映射项不是必需的, 因为它们是标准虚函数。

您可以使用 Windows [CommDlgExtendedError](/windows/win32/api/commdlg/nf-commdlg-commdlgextendederror)函数来确定初始化对话框期间是否发生了错误, 并了解有关错误的详细信息。

自动处理`CFileDialog`对象的析构。 无需调用[CDialog:: EndDialog](../../mfc/reference/cdialog-class.md#enddialog)。

若要允许用户选择多个文件, 请在调用`DoModal`之前设置 OFN_ALLOWMULTISELECT 标志。 你必须提供自己的文件名缓冲区以容纳返回的多个文件名的列表。 为此, 请`m_ofn.lpstrFile`在`CFileDialog`构造之后但在调用`DoModal`之前, 将替换为指向已分配缓冲区的指针。

此外, 还必须使用`m_ofn.nMaxFile`所指向`m_ofn.lpstrFile`的缓冲区中的字符数进行设置。 如果将所选文件的最大数目设置为`n`, 则所需的缓冲区大小为。 `n * (_MAX_PATH + 1) + 1` 缓冲区中返回的第一项是选定文件的文件夹的路径。 对于 Windows Vista 或更高版本的对话框, 目录和文件名字符串以 null 结尾, 最后一个文件名后面有一个额外的 null 字符。 此格式允许资源管理器样式的对话框返回包含空格的长文件名。 对于旧式对话框, 目录和文件名字符串由空格分隔, 并且函数使用带有空格的文件名的短文件名。

下面的示例演示如何使用缓冲区检索和列出多个文件名。

[!code-cpp[NVC_MFCFiles#23](../../atl-mfc-shared/reference/codesnippet/cpp/cfiledialog-class_1.cpp)]

若要更改缓冲区大小以响应用户选择多个文件名, 则必须从`CFileDialog`派生新类, 并重写[CFileDialog:: OnFileNameChange](#onfilenamechange)方法。

如果从`CFileDialog`派生新类, 则可以使用消息映射来处理任何消息。 若要扩展默认消息处理, 请从`CFileDialog`派生类, 将消息映射添加到新类, 并为新消息提供成员函数。 不必提供挂钩函数来自定义对话框。

若要自定义对话框, 从`CFileDialog`派生类, 提供自定义对话框模板, 并添加消息映射来处理来自扩展控件的通知消息。 将所有未处理的消息传递给基类。 无需自定义挂钩函数。

如果使用的是 Windows Vista 或更高版本`CFileDialog`, 则无法使用消息映射和对话框模板。 相反, 你必须使用 COM 接口来实现类似的功能。

有关如何使用`CFileDialog`的详细信息, 请参阅[通用对话框类](../../mfc/common-dialog-classes.md)。

## <a name="inheritance-hierarchy"></a>继承层次结构

[CObject](../../mfc/reference/cobject-class.md)

[CCmdTarget](../../mfc/reference/ccmdtarget-class.md)

[CWnd](../../mfc/reference/cwnd-class.md)

[CDialog](../../mfc/reference/cdialog-class.md)

[CCommonDialog](../../mfc/reference/ccommondialog-class.md)

`CFileDialog`

## <a name="requirements"></a>要求

**标头:** afxdlgs

##  <a name="addcheckbutton"></a>CFileDialog:: AddCheckButton

向对话框添加复选按钮。

```
HRESULT AddCheckButton(
    DWORD dwIDCtl,
    const CString& strLabel,
    BOOL bChecked);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
要添加的复选按钮的 ID。

*strLabel*<br/>
复选按钮名称。

*bChecked*<br/>
指示复选按钮当前状态的布尔值。 如果选中, 则为 TRUE;否则为 FALSE

### <a name="remarks"></a>备注

##  <a name="addcombobox"></a>CFileDialog:: AddComboBox

向对话框中添加组合框。

```
HRESULT AddComboBox(DWORD dwIDCtl);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
要添加的组合框的 ID。

### <a name="remarks"></a>备注

##  <a name="addcontrolitem"></a>CFileDialog:: AddControlItem

将项添加到对话框中的容器控件。

```
HRESULT AddControlItem(
    DWORD dwIDCtl,
    DWORD dwIDItem,
    const CString& strLabel);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
要向其中添加项的容器控件的 ID。

*dwIDItem*<br/>
项的 ID。

*strLabel*<br/>
项的文本。

### <a name="remarks"></a>备注

##  <a name="addeditbox"></a>CFileDialog:: AddEditBox

将编辑框添加到对话框中。

```
HRESULT AddEditBox(
    DWORD dwIDCtl,
    const CString& strText);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
要添加的编辑框的 ID。

*strText*<br/>
编辑框的名称。

### <a name="remarks"></a>备注

##  <a name="addmenu"></a>CFileDialog:: AddMenu

将菜单添加到对话框。

```
HRESULT AddMenu(
    DWORD dwIDCtl,
    const CString& strLabel);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
要添加的菜单的 ID。

*strLabel*<br/>
菜单名称。

### <a name="remarks"></a>备注

##  <a name="addplace"></a>CFileDialog:: AddPlace

将文件夹添加到可供用户打开或保存项目的位置列表中。

```
void AddPlace(
    LPCWSTR lpszFolder,
    FDAP fdap = FDAP_TOP) throw();

void AddPlace(
    IShellItem* psi,
    FDAP fdap = FDAP_TOP) throw();
```

### <a name="parameters"></a>参数

*lpszFolder*<br/>
要提供给用户的文件夹的路径。 它只能是文件夹。

*fdap*<br/>
指定文件夹在列表中的放置位置。

*psi*<br/>
指向 IShellItem 的指针, 该指针表示用户可用的文件夹。 它只能是文件夹。

### <a name="remarks"></a>备注

##  <a name="addpushbutton"></a>CFileDialog:: AddPushButton

向对话框添加一个按钮。

```
HRESULT AddPushButton(
    DWORD dwIDCtl,
    const CString& strLabel);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
要添加的按钮的 ID。

*strLabel*<br/>
按钮名称。

### <a name="remarks"></a>备注

##  <a name="addradiobuttonlist"></a>CFileDialog:: AddRadioButtonList

将选项按钮 (也称为单选按钮) 组添加到对话框。

```
HRESULT AddRadioButtonList(DWORD dwIDCtl);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
要添加的选项按钮组的 ID。

### <a name="remarks"></a>备注

##  <a name="addseparator"></a>CFileDialog:: AddSeparator

将分隔符添加到对话框。

```
HRESULT AddSeparator(DWORD dwIDCtl);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
分隔符的添加 ID。

### <a name="remarks"></a>备注

##  <a name="addtext"></a>CFileDialog:: Shapes.addtext

向对话框添加文本。

```
HRESULT AddText(
    DWORD dwIDCtl,
    const CString& strText);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
要添加的文本的 ID。

*strText*<br/>
文本名称。

### <a name="remarks"></a>备注

##  <a name="applyofntoshelldialog"></a>  CFileDialog::ApplyOFNToShellDialog

基于存储在`m_ofn`数据结构中的值更新[CFileDialog](../../mfc/reference/cfiledialog-class.md)的当前状态。

```
void ApplyOFNToShellDialog();
```

### <a name="remarks"></a>备注

在 Windows Vista 之前的 Windows 版本中, 成员[OPENFILENAME](/previous-versions/windows/embedded/ms911906\(v=msdn.10\))数据结构与的`CFileDialog`状态保持同步。 对[m_ofn](#m_ofn)成员变量所做的任何更改都会立即反映在对话框的状态中。 而且, 对对话框状态所做的任何更改都会立即更新`m_ofn`成员变量。

在 Windows Vista 或更高版本中, 不`m_ofn`保证同步成员变量中的`CFileDialog`值和的状态。 此函数强制更新的`CFileDialog`状态以`m_ofn`匹配结构。 Windows 在 CFileDialog 期间自动调用此函数[::D omodal](#domodal)。

有关如何在 Windows Vista 或更高`CFileDialog`版本下使用类的详细信息, 请参阅[CFileDialog 类](../../mfc/reference/cfiledialog-class.md)。

### <a name="example"></a>示例

  请参阅[CFileDialog:: UpdateOFNFromShellDialog](#updateofnfromshelldialog)的示例。

##  <a name="cfiledialog"></a>CFileDialog:: CFileDialog

调用此函数可构造标准 Windows 文件对话框。

```
explicit CFileDialog(
    BOOL bOpenFileDialog,
    LPCTSTR lpszDefExt = NULL,
    LPCTSTR lpszFileName = NULL,
    DWORD dwFlags = OFN_HIDEREADONLY | OFN_OVERWRITEPROMPT,
    LPCTSTR lpszFilter = NULL,
    CWnd* pParentWnd = NULL,
    DWORD dwSize = 0,
    BOOL bVistaStyle = TRUE);
```

### <a name="parameters"></a>参数

*bOpenFileDialog*<br/>
中用于指定要创建的对话框类型的参数。 将其设置为 TRUE 可构造**文件打开**对话框。 将其设置为 FALSE 可构造 "**另存为**" 对话框。

*lpszDefExt*<br/>
中默认的文件扩展名。 如果用户没有在 "文件名" 框中包含已知扩展 (用户计算机上有关联的扩展名), 则*lpszDefExt*指定的扩展将自动追加到文件名。 如果此参数为 NULL, 则不追加扩展。

*lpszFileName*<br/>
中出现在 "文件名" 框中的初始文件名。 如果为 NULL, 则不会出现初始文件名。

*dwFlags*<br/>
中可用于自定义对话框的一个或多个标志的组合。 有关这些标志的说明, 请参阅 Windows SDK 中的[OPENFILENAME](/windows/win32/api/commdlg/ns-commdlg-openfilenamew)结构。 如果修改`m_ofn.Flags`结构成员, 请在更改中使用按位 "或" 运算符, 使默认行为保持不变。

*lpszFilter*<br/>
中一系列字符串对, 用于指定可应用于文件的筛选器。 如果指定文件筛选器, 文件列表中将只显示符合筛选条件的文件。 有关如何使用文件筛选器的详细信息, 请参阅 "备注" 部分。

*pParentWnd*<br/>
中指向文件对话框的父窗口或所有者窗口的指针。

*dwSize*<br/>
中`OPENFILENAME`结构的大小。 此值取决于操作系统版本。 MFC 使用此参数来确定要创建的适当类型的对话框。 默认大小为 0, 这意味着 MFC 代码将根据运行程序的操作系统版本确定要使用的正确对话框大小。

*bVistaStyle*<br/>
中**注意**此参数在 Visual Studio 2008 及更高版本中提供, 并且仅当在 Windows Vista 或更高版本中运行时, 才会使用新样式的对话框。

指定文件对话框样式的参数。 将其设置为 TRUE 可使用新的 Vista 样式文件对话框。 否则, 将使用旧样式的对话框。 有关在 Vista 下运行的详细信息, 请参阅 "备注" 部分。

### <a name="remarks"></a>备注

构造 "**文件打开**" 或 "**文件另存为**" 对话框, 具体取决于*bOpenFileDialog*的值。

使用*lpszDefExt*指定默认扩展可能不会产生所需的行为, 因为它很少预测哪些扩展在用户的计算机上有文件关联。 如果需要更好地控制默认扩展插件的追加, 可以从`CFileDialog`派生您自己的类, 并重`CFileDialog::OnFileNameOK`写方法以执行您自己的扩展处理。

若要允许用户选择多个文件, 请在调用[DoModal](#domodal)之前设置 OFN_ALLOWMULTISELECT 标志。 你必须提供自己的文件名缓冲区来存储返回的多个文件名的列表。 为此, 请`m_ofn.lpstrFile`将替换为指向已分配缓冲区的指针, 并在构造[CFileDialog](../../mfc/reference/cfiledialog-class.md)之后, 在调用`DoModal`之前进行。 此外, 还必须使用`m_ofn.nMaxFile`所指向`m_ofn.lpstrFile`的缓冲区中的字符数进行设置。 如果将所选文件的最大数目设置为*n*, 则所需的缓冲区大小`n`为 * (_MAX_PATH + 1) + 1。 例如：

[!code-cpp[NVC_MFCFiles#23](../../atl-mfc-shared/reference/codesnippet/cpp/cfiledialog-class_1.cpp)]

若要允许用户通过使用鼠标或键盘来调整资源管理器样式对话框的大小, 请设置 OFN_ENABLESIZING 标志。 仅当提供了挂钩过程或自定义模板时, 才需要设置此标志。 标志仅适用于 "资源管理器样式" 对话框;无法调整旧样式对话框的大小。

*LpszFilter*参数用于确定文件必须在文件列表中显示的文件名类型。 字符串对中的第一个字符串描述了筛选器;第二个字符串指示要使用的文件扩展名。 可以通过使用分号 (";" 字符) 作为分隔符来指定多个扩展名。 字符串以两个&#124;字符结尾, 后跟一个 NULL 字符。 还可以对此参数使用[CString](../../atl-mfc-shared/using-cstring.md)对象。

例如, Microsoft Excel 允许用户打开扩展名为 xlc (图表) 或 .xls (工作表) 的文件, 以及其他。 Excel 筛选器可以编写为:

[!code-cpp[NVC_MFCFiles#24](../../atl-mfc-shared/reference/codesnippet/cpp/cfiledialog-class_2.cpp)]

但是, 如果您计划使用此字符串直接更新`OPENFILENAME`结构, 则应使用空字符 "\ 0" 而不是竖线 ("&#124;") 来分隔字符串。

仅当在 Windows Vista 或更高版本下运行时, *bVistaStyle*参数才适用。 在 Windows 的早期版本下, 将忽略此参数。 如果将*bVistaStyle*设置为 TRUE, 则在使用 Visual Studio 2008 或更高版本编译程序时, 将使用 "新建 Vista 样式**文件" 对话框**。 否则, 将使用之前的 MFC 样式**文件对话框**。

基于*bVistaStyle*的对话框不支持对话框模板

### <a name="example"></a>示例

  请参阅[CFileDialog::D omodal](#domodal)的示例。

##  <a name="domodal"></a>CFileDialog::D oModal

调用此函数以显示 Windows common file 对话框, 并允许用户浏览文件和目录, 并输入文件名。

```
virtual INT_PTR DoModal();
```

### <a name="return-value"></a>返回值

IDOK 或 IDCANCEL。 如果返回 IDCANCEL, 则调用 Windows [CommDlgExtendedError](/windows/win32/api/commdlg/nf-commdlg-commdlgextendederror)函数来确定是否发生了错误。

IDOK 和 IDCANCEL 是常量, 用于指示用户是否选择了 "确定" 或 "取消" 按钮。

### <a name="remarks"></a>备注

如果要通过设置`m_ofn`结构的成员来初始化各种文件对话框选项, 应在调用`DoModal`之前执行此操作, 但在构造对话框对象之后。

例如, 如果想要允许用户选择多个文件, 请在调用`DoModal`之前设置 OFN_ALLOWMULTISELECT 标志, 如本主题中的代码示例中所示。

当用户单击对话框的 "确定" 或 "取消" 按钮, 或从对话框的 "控制" 菜单中选择 "关闭" 选项时, 控件将返回到应用程序。 然后, 可以调用其他成员函数来检索用户在对话框中输入的设置或信息。

`DoModal`是从类`CDialog`重写的虚函数。

### <a name="example"></a>示例

[!code-cpp[NVC_MFCFiles#25](../../atl-mfc-shared/reference/codesnippet/cpp/cfiledialog-class_3.cpp)]

##  <a name="enableopendropdown"></a>CFileDialog:: EnableOpenDropDown

启用对话框中的 "打开" 或 "保存" 按钮上的下拉列表。

```
HRESULT EnableOpenDropDown(DWORD dwIDCtl);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
下拉列表的 ID。

### <a name="remarks"></a>备注

##  <a name="endvisualgroup"></a>CFileDialog:: EndVisualGroup

停止向对话框中的可视组添加元素。

```
HRESULT EndVisualGroup();
```

### <a name="return-value"></a>返回值

如果成功, 则返回 S_OK;否则为错误值。

### <a name="remarks"></a>备注

##  <a name="getcheckbuttonstate"></a>CFileDialog:: GetCheckButtonState

检索对话框中选中按钮 (复选框) 的当前状态。

```
HRESULT GetCheckButtonState(
    DWORD dwIDCtl,
    BOOL& bChecked);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
复选框的 ID。

*bChecked*<br/>
复选框的状态。 如果为 TRUE, 则表示已选中;FALSE 表示未选中。

### <a name="remarks"></a>备注

##  <a name="getcontrolitemstate"></a>CFileDialog:: GetControlItemState

检索容器控件中在对话框中找到的项的当前状态。

```
HRESULT GetControlItemState(
    DWORD dwIDCtl,
    DWORD dwIDItem,
    CDCONTROLSTATEF& dwState);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
容器控件的 ID。

*dwIDItem*<br/>
项的 ID。

*dwState*<br/>
对变量的引用, 该变量接收来自 CDCONTROLSTATE 枚举的一个值, 该值指示控件的当前状态。

### <a name="remarks"></a>备注

##  <a name="getcontrolstate"></a>CFileDialog:: GetControlState

检索给定控件的当前可见性和已启用状态。

```
HRESULT GetControlState(
    DWORD dwIDCtl,
    CDCONTROLSTATEF& dwState);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
控件的 ID。

*dwState*<br/>
对从 CDCONTROLSTATE 枚举接收一个或多个值的变量, 该变量指示控件的当前状态。

### <a name="remarks"></a>备注

##  <a name="geteditboxtext"></a>CFileDialog:: GetEditBoxText

检索编辑框控件中的当前文本。

```
HRESULT GetEditBoxText(
    DWORD dwIDCtl,
    CString& strText);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
编辑框的 ID。

*strText*<br/>
文本值。

### <a name="remarks"></a>备注

##  <a name="getfileext"></a>CFileDialog:: GetFileExt

调用此函数可检索在对话框中输入的文件名的扩展名。

```
CString GetFileExt() const;
```

### <a name="return-value"></a>返回值

文件名的扩展名。

### <a name="remarks"></a>备注

例如, 如果输入的文件的名称为 DATA。Txt, `GetFileExt`返回 "TXT"。

如果`m_ofn.Flags`设置了 OFN_ALLOWMULTISELECT 标志, 则该字符串将包含一个以 null 结尾的字符串序列, 其中第一个字符串是所选文件组的目录路径, 后跟用户选定的所有文件的名称。 若要检索文件路径名, 请使用[GetStartPosition](#getstartposition)和[GetNextPathName](#getnextpathname)成员函数。

##  <a name="getfilename"></a>CFileDialog:: GetFileName

调用此函数可检索在对话框中输入的文件名。

```
CString GetFileName() const;
```

### <a name="return-value"></a>返回值

文件的名称。

### <a name="remarks"></a>备注

该文件的名称同时包含前缀和扩展名。 例如, `GetFileName`将返回 "TEXT"。"C:\FILES\TEXT.DAT. 的 DAT"

如果`m_ofn.Flags`设置了 `OFN_ALLOWMULTISELECT`标志, 则应调用 [GetStartPosition](#getstartposition) 和 [GetNextPathName](#getnextpathname) 来检索文件路径名。

##  <a name="getfiletitle"></a>CFileDialog:: GetFileTitle

调用此函数可检索在对话框中输入的文件的标题。

```
CString GetFileTitle() const;
```

### <a name="return-value"></a>返回值

文件的标题。

### <a name="remarks"></a>备注

该文件的标题只包含其前缀, 无路径或扩展名。 例如, `GetFileTitle`将为文件 C:\FILES\TEXT.DAT. 返回 "TEXT"。

如果`m_ofn.Flags`设置了 OFN_ALLOWMULTISELECT 标志, 则该字符串将包含一个以 null 结尾的字符串序列, 其中第一个字符串是所选文件组的目录路径, 后跟用户选定的所有文件的名称。 出于此原因, 请使用[GetStartPosition](#getstartposition)和[GetNextPathName](#getnextpathname)成员函数检索列表中的下一个文件名。

### <a name="example"></a>示例

  请参阅[CFileDialog::D omodal](#domodal)的示例。

##  <a name="getfolderpath"></a>CFileDialog:: GetFolderPath

调用此成员函数以检索资源管理器样式的 "打开" 或 "另存为公用" 对话框的当前打开的文件夹或目录的路径。

```
CString GetFolderPath() const;
```

### <a name="return-value"></a>返回值

一个[CString](../../atl-mfc-shared/reference/cstringt-class.md)对象, 其中包含当前打开的文件夹或目录。

### <a name="remarks"></a>备注

必须已使用 OFN_EXPLORER 样式创建对话框;否则, 该方法将失败并带有断言。

仅当显示该对话框时才能调用此方法。 对话框关闭后, 此函数将不再工作, 并且该方法将失败并带有断言。

##  <a name="getifiledialogcustomize"></a>CFileDialog:: GetIFileDialogCustomize

检索指向给定[CFileDialog](../../mfc/reference/cfiledialog-class.md)的内部 COM 对象的指针。

```
IFileDialogCustomize* GetIFileDialogCustomize();
```

### <a name="return-value"></a>返回值

指向的内部 COM 对象`CFileDialog`的指针。 你需要负责适当地释放此指针。

### <a name="remarks"></a>备注

仅在 Windows Vista 或更高版本中将此函数用于将*bVistaStyle*设置为 TRUE 的对象。 如果在*bVistaStyle*为 FALSE 时使用此函数, 它将在发布模式下返回 NULL, 并在调试模式下引发断言。

有关`IFileDialogCustomize`接口的详细信息, 请参阅[IFileDialogCustomize](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ifiledialogcustomize)。

### <a name="example"></a>示例

此示例检索内部 COM 对象。 若要运行此代码示例, 必须在 Windows Vista 或更高版本下编译它。

[!code-cpp[NVC_MFC_CFileDialog#4](../../mfc/reference/codesnippet/cpp/cfiledialog-class_4.cpp)]

##  <a name="getifileopendialog"></a>CFileDialog:: GetIFileOpenDialog

检索指向给定`CFileDialog`的内部 COM 对象的指针。

```
IFileOpenDialog* GetIFileOpenDialog();
```

### <a name="return-value"></a>返回值

指向的内部 COM 对象`CFileDialog`的指针。 你需要负责适当地释放此指针。

### <a name="remarks"></a>备注

仅在 Windows Vista 或更高版本中将此函数用于将*bVistaStyle*设置为 TRUE 的对象。 如果不是 "**打开**" `CFileDialog`对话框, 或者如果*bVistaStyle*设置为 FALSE, 则此函数将返回 NULL。 在此最终情况下, 函数仅在发布模式下返回 NULL-在调试模式下, 它将引发断言。

有关`IFileOpenDialog`接口的详细信息, 请参阅[IFileOpenDialog](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ifileopendialog)。

### <a name="example"></a>示例

此示例检索内部 COM 对象。 若要运行此代码, 必须在 Windows Vista 或更高版本下编译它。

[!code-cpp[NVC_MFC_CFileDialog#2](../../mfc/reference/codesnippet/cpp/cfiledialog-class_5.cpp)]

##  <a name="getifilesavedialog"></a>CFileDialog:: GetIFileSaveDialog

检索指向给定`CFileDialog`的内部 COM 对象的指针。

```
IFileSaveDialog* GetIFileSaveDialog();
```

### <a name="return-value"></a>返回值

指向的内部 COM 对象`CFileDialog`的指针。 你需要负责适当地释放此指针。

### <a name="remarks"></a>备注

仅在 Windows Vista 或更高版本中将此函数用于将*bVistaStyle*设置为 TRUE 的对象。 如果不是 " `CFileDialog` **保存**" 对话框, 或者如果*bVistaStyle*设置为 FALSE, 则此函数将返回 NULL。 在此最终情况下, 函数仅在发布模式下返回 NULL-在调试模式下, 它将引发断言。

有关`IFileSaveDialog`接口的详细信息, 请参阅[IFileSaveDialog](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ifilesavedialog)。

### <a name="example"></a>示例

此示例检索内部 COM 对象。 若要运行此代码示例, 必须在 Windows Vista 或更高版本下编译它。

[!code-cpp[NVC_MFC_CFileDialog#3](../../mfc/reference/codesnippet/cpp/cfiledialog-class_6.cpp)]

##  <a name="getnextpathname"></a>CFileDialog:: GetNextPathName

调用此函数可检索在对话框中所选组中的下一个文件名。

```
CString GetNextPathName(POSITION& pos) const;
```

### <a name="parameters"></a>参数

*位置*<br/>
对 previous `GetNextPathName`或`GetStartPosition`函数调用返回的位置值的引用。 如果已到达列表的末尾, 则为 NULL。

### <a name="return-value"></a>返回值

文件的完整路径。

### <a name="remarks"></a>备注

文件名的路径包含文件的标题和整个目录路径。 例如, `GetNextPathName`将返回 "C:\FILES\TEXT。"C:\FILES\TEXT.DAT. 的 DAT" 如果使用对`GetNextPathName` `GetStartPosition`的调用建立初始位置, 则可以在向前迭代循环中使用。

如果选择仅包含一个文件, 则将返回该文件的名称。

##  <a name="getofn"></a>CFileDialog:: GetOFN

检索关联`OPENFILENAME`的结构。

```
const OPENFILENAME& GetOFN() const;

OPENFILENAME& GetOFN();
```

### <a name="return-value"></a>返回值

[OPENFILENAME](/windows/win32/api/commdlg/ns-commdlg-openfilenamew)结构。

### <a name="remarks"></a>备注

使用此函数的第二个版本, 可以在构造**文件打开**或**保存**文件后将其`DoModal`显示为对话框, 但在与成员函数一起显示之前。 例如, 你可以将的`lpstrTitle` `m_ofn`成员设置为你希望对话框具有的标题。

##  <a name="getpathname"></a>CFileDialog:: GetPathName

调用此函数可检索在对话框中输入的文件的完整路径。

```
CString GetPathName() const;
```

### <a name="return-value"></a>返回值

文件的完整路径。

### <a name="remarks"></a>备注

文件名的路径包含文件的标题和整个目录路径。 例如, `GetPathName`将返回 "C:\FILES\TEXT。"C:\FILES\TEXT.DAT. 的 DAT"

如果`m_ofn.Flags`设置了 OFN_ALLOWMULTISELECT 标志, 则该字符串将包含一个 teminated 字符串序列, 其中第一个字符串是所选文件组的目录路径, 后跟用户选定的所有文件的名称。 出于此原因, 请使用[GetStartPosition](#getstartposition)和[GetNextPathName](#getnextpathname)成员函数检索列表中的下一个文件名。

### <a name="example"></a>示例

  请参阅[CFileDialog::D omodal](#domodal)的示例。

##  <a name="getreadonlypref"></a>CFileDialog:: GetReadOnlyPref

调用此函数可确定是否已在 Windows 标准文件 "打开" 和 "另存为" 对话框中选择了 "只读" 复选框。

```
BOOL GetReadOnlyPref() const;
```

### <a name="return-value"></a>返回值

如果选择对话框中的 "只读" 复选框, 则为非零值;否则为0。

### <a name="remarks"></a>备注

您可以通过在`CFileDialog`构造函数中设置 OFN_HIDEREADONLY 样式来隐藏 "只读" 复选框。

> [!NOTE]
> Windows Vista 或更高`CFileDialog`版本的样式对象不支持此函数。 尝试在 Windows Vista 或更高版本`CFileDialog`上使用此函数将引发[CNotSupportedException](../../mfc/reference/cnotsupportedexception-class.md)。

##  <a name="getresult"></a>CFileDialog:: GetResult

检索用户在对话框中所做的选择。

```
IShellItem* GetResult() throw();
```

### <a name="return-value"></a>返回值

指向表示用户选择的 IShellItem 的指针。

### <a name="remarks"></a>备注

##  <a name="getresults"></a>CFileDialog:: GetResults

检索允许多重选择的对话框中的用户选择。

```
IShellItemArray* GetResults() throw();
```

### <a name="return-value"></a>返回值

指向 IShellItemArray 的指针, 通过它可以访问对话框中选定的项。

### <a name="remarks"></a>备注

##  <a name="getselectedcontrolitem"></a>CFileDialog:: GetSelectedControlItem

检索对话框中指定容器控件中的特定项。

```
HRESULT GetSelectedControlItem(
    DWORD dwIDCtl,
    DWORD& dwIDItem);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
容器控件的 ID。

*dwIDItem*<br/>
用户在控件中选择的项的 ID。

### <a name="remarks"></a>备注

##  <a name="getstartposition"></a>CFileDialog:: GetStartPosition

如果`m_ofn.Flags`设置了 OFN_ALLOWMULTISELECT 标志, 则调用此成员函数以检索列表中第一个文件路径名的位置。

```
POSITION GetStartPosition() const;
```

### <a name="return-value"></a>返回值

可用于迭代的位置值;如果列表为空, 则为 NULL。

##  <a name="hidecontrol"></a>CFileDialog:: HideControl

调用此成员函数可在资源管理器样式的 "打开" 或 "另存为公用" 对话框中隐藏指定的控件。

```
void HideControl(int nID);
```

### <a name="parameters"></a>参数

*nID*<br/>
要隐藏的控件的 ID。

### <a name="remarks"></a>备注

必须已使用 OFN_EXPLORER 样式创建对话框;否则, 该函数将失败并返回一个断言。

##  <a name="ispickfoldersmode"></a>CFileDialog:: IsPickFoldersMode

确定当前对话框是否处于文件夹选取器模式。

```
BOOL IsPickFoldersMode() const;
```

### <a name="return-value"></a>返回值

如果对话框处于文件夹选取器模式, 则为 TRUE;否则为 FALSE。

### <a name="remarks"></a>备注

##  <a name="m_ofn"></a>CFileDialog:: m_ofn

`m_ofn`是类型`OPENFILENAME`的结构。 此结构中的数据表示的当前状态`CFileDialog`。

### <a name="remarks"></a>备注

使用此结构可以在构造**文件**后对其进行初始化 , 但在使用[DoModal](#domodal)方法显示该对话框之前, 对其进行初始化。 例如, 可以将的`m_ofn` *lpstrTitle*成员设置为希望该对话框具有的标题。

对于 Windows Vista 或更高版本的[CFileDialog](../../mfc/reference/cfiledialog-class.md), `m_ofn`不能保证始终匹配对话框的状态。 它与 Windows 早期版本中的对话框保持同步。 有关在 Windows Vista 或更高版本下同步`m_ofn`结构和`CFileDialog`状态的详细信息, 请参阅[CFileDialog:: ApplyOFNToShellDialog](#applyofntoshelldialog)和[CFileDialog:: UpdateOFNFromShellDialog](#updateofnfromshelldialog) 。

Windows Vista 或更高版本的样式文件对话框不支持某些成员和标志`CFileDialog`。 因此, 这些将不起作用。

下面是 Windows Vista 或更高版本不支持的成员列表:

- `lpstrCustomFilter`

- `lpstrInitialDir`

- `lCustData`

- `lpfnHook`

- `lpTemplateName`

以下标志不受支持, 因此, 当你使用的 Windows Vista 或更高版本样式`CFileDialog`时, 它们不起作用:

- OFN_ENABLEHOOK

- OFN_ENABLEINCLUDENOTIFY

- OFN_ENABLETEMPLATE

- OFN_ENABLETEMPLATEHANDLE

- OFN_EXPLORER

- OFN_EXTENSIONDIFFERENT

- OFN_HIDEREADONLY

- OFN_LONGNAMES-在 Windows Vista 或更高版本中有效 always on

- OFN_NOLONGNAMES-在 Windows Vista 或更高版本中有效地始终关闭

- OFN_NONETWORKBUTTON-在 Windows Vista 或更高版本中有效 always on

- OFN_READONLY

- OFN_SHOWHELP

有关此结构的详细信息, 请参阅 Windows SDK 中的[OPENFILENAME](/windows/win32/api/commdlg/ns-commdlg-openfilenamew)结构。

##  <a name="makeprominent"></a>CFileDialog:: MakeProminent

将控件放置在对话框中, 使其与其他控件不同。

```
HRESULT MakeProminent(DWORD dwIDCtl);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
控件的 ID。

### <a name="remarks"></a>备注

##  <a name="onbuttonclicked"></a>  CFileDialog::OnButtonClicked

在单击按钮时调用。

```
virtual void OnButtonClicked(DWORD dwIDCtl);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
按钮的 ID。

### <a name="remarks"></a>备注

##  <a name="oncheckbuttontoggled"></a>CFileDialog:: OnCheckButtonToggled

选中或取消选中复选框时调用。

```
virtual void OnCheckButtonToggled(
    DWORD dwIDCtl,
    BOOL bChecked);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
复选框的 ID。

*bChecked*<br/>
已选中或未选中。

### <a name="remarks"></a>备注

##  <a name="oncontrolactivating"></a>CFileDialog:: OnControlActivating

当控件激活时调用。

```
virtual void OnControlActivating(DWORD dwIDCtl);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
控件的 ID。

### <a name="remarks"></a>备注

##  <a name="onfilenamechange"></a>CFileDialog:: OnFileNameChange

如果要处理 WM_NOTIFY CDN_SELCHANGE 消息, 请重写此方法。

```
virtual void OnFileNameChange();
```

### <a name="remarks"></a>备注

当用户在 "**打开**" 或 "**另存为**" 对话框的文件列表中选择新文件或文件夹时, 系统将发送 CDN_SELCHANGE 消息。 如果要执行任何操作来响应此消息, 请重写此方法。

仅当对话框是在启用了 OFN_EXPLORER 标志的情况下创建的时, 系统才会发送此消息。 有关通知的详细信息, 请参阅[CDN_SELCHANGE](/windows/win32/dlgbox/cdn-selchange)。 有关 OFN_EXPLORER 标志的信息, 请参阅[OPENFILENAME](/windows/win32/api/commdlg/ns-commdlg-openfilenamew)结构和 "[打开" 和 "另存为" 对话框](/windows/win32/dlgbox/open-and-save-as-dialog-boxes)。

##  <a name="onfilenameok"></a>  CFileDialog::OnFileNameOK

仅当要提供输入到公共文件对话框中的文件名的自定义验证时, 重写此函数。

```
virtual BOOL OnFileNameOK();
```

### <a name="return-value"></a>返回值

如果文件名不是有效的文件名, 则为 1;否则为0。

### <a name="remarks"></a>备注

此函数允许您出于任何特定于应用程序的原因拒绝文件名。 通常不需要使用此函数, 因为框架提供文件名的默认验证, 如果输入无效的文件名, 则会显示消息框。

如果返回 1, 则将继续显示该对话框, 以便用户输入另一个文件名。 如果返回的是 0, 则对话框过程会关闭对话框。 其他非零返回值当前是保留值, 不应使用。

##  <a name="onfolderchange"></a>CFileDialog:: OnFolderChange

重写此函数以处理 WM_NOTIFYCDN_FOLDERCHANGE 消息。

```
virtual void OnFolderChange();
```

### <a name="remarks"></a>备注

当在 "打开" 或 "另存为" 对话框中打开新文件夹时, 将发送通知消息。

仅当该对话框是用 OFN_EXPLORER 样式创建的时, 才发送通知。 有关通知的详细信息, 请参阅[CDN_FOLDERCHANGE](/windows/win32/dlgbox/cdn-folderchange)。 有关 OFN_EXPLORER 样式的信息, 请参阅[OPENFILENAME](/windows/win32/api/commdlg/ns-commdlg-openfilenamew)结构和 "[打开" 和 "另存为" 对话框](/windows/win32/dlgbox/open-and-save-as-dialog-boxes)。

##  <a name="oninitdone"></a>CFileDialog:: OnInitDone

重写此函数以处理 WM_NOTIFY CDN_INITDONE 消息。

```
virtual void OnInitDone();
```

### <a name="remarks"></a>备注

系统在 "**打开**" 或 "**另存为**" 对话框中完成排列控件以为子对话框的控件腾出空间时, 系统将发送此通知消息。

只有在创建了具有 OFN_EXPLORER 样式的对话框时, 系统才会发送此对话框。 有关通知的详细信息, 请参阅[CDN_INITDONE](/windows/win32/dlgbox/cdn-initdone)。 有关 OFN_EXPLORER 样式的信息, 请参阅[OPENFILENAME](/windows/win32/api/commdlg/ns-commdlg-openfilenamew)结构和 "[打开" 和 "另存为" 对话框](/windows/win32/dlgbox/open-and-save-as-dialog-boxes)。

> [!NOTE]
> Windows Vista 或更高版本的样式文件对话框不支持此函数。 尝试在 Windows Vista 或更高版本的样式文件对话框上使用此函数将引发[CNotSupportedException](../../mfc/reference/cnotsupportedexception-class.md)。

##  <a name="onitemselected"></a>  CFileDialog::OnItemSelected

在选择容器项时调用。

```
virtual void OnItemSelected(
    DWORD dwIDCtl,
    DWORD dwIDItem);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
容器控件的 ID。

*dwIDItem*<br/>
项的 ID。

### <a name="remarks"></a>备注

##  <a name="onlbselchangednotify"></a>CFileDialog:: OnLBSelChangedNotify

只要列表框中的当前选定内容将要更改, 就会调用此函数。

```
virtual void OnLBSelChangedNotify(
    UINT nIDBox,
    UINT iCurSel,
    UINT nCode);
```

### <a name="parameters"></a>参数

*nIDBox*<br/>
所选内容所在的列表框或组合框的 ID。

*iCurSel*<br/>
当前选择的索引。

*nCode*<br/>
控件通知代码。 此参数必须具有以下值之一:

- CD_LBSELCHANGE 指定*iCurSel*是单项选择列表框中的选定项。

- CD_LBSELSUB 指定*iCurSel*在多选列表框中不再处于选中状态。

- CD_LBSELADD 指定在多选列表框中选择*iCurSel* 。

- CD_LBSELNOITEMS 指定多选列表框中不存在任何选择。

### <a name="remarks"></a>备注

重写此函数可在列表框中提供对选择更改的自定义处理。 例如, 您可以使用此函数显示用户选择的每个文件的访问权限或上次修改日期。

##  <a name="onshareviolation"></a>CFileDialog:: OnShareViolation

重写此函数可提供共享冲突的自定义处理。

```
virtual UINT OnShareViolation(LPCTSTR lpszPathName);
```

### <a name="parameters"></a>参数

*lpszPathName*<br/>
发生共享冲突的文件的路径。

### <a name="return-value"></a>返回值

以下值之一：

- OFN_SHAREFALLTHROUGH 从对话框返回文件名。

- OFN_SHARENOWARN 无需执行任何其他操作。

- OFN_SHAREWARN 用户收到此错误的标准警告消息。

### <a name="remarks"></a>备注

通常不需要使用此函数, 因为框架提供共享冲突的默认检查, 并在发生共享冲突时显示消息框。

如果要禁用共享冲突检查, 请使用按位 "或" 运算符将标志 OFN_SHAREAWARE 与`m_ofn.Flags`结合使用。

##  <a name="ontypechange"></a>CFileDialog:: OnTypeChange

重写此函数以处理 WM_NOTIFYCDN_TYPECHANGE 消息。

```
virtual void OnTypeChange();
```

### <a name="remarks"></a>备注

当用户从 "打开" 或 "另存为" 对话框中的文件类型列表中选择新的文件类型时, 将发送通知消息。

仅当该对话框是用 OFN_EXPLORER 样式创建的时, 才发送通知。 有关通知的详细信息, 请参阅[CDN_TYPECHANGE](/windows/win32/dlgbox/cdn-typechange)。 有关 OFN_EXPLORER 样式的信息, 请参阅[OPENFILENAME](/windows/win32/api/commdlg/ns-commdlg-openfilenamew)结构和 "[打开" 和 "另存为" 对话框](/windows/win32/dlgbox/open-and-save-as-dialog-boxes)。

##  <a name="removecontrolitem"></a>  CFileDialog::RemoveControlItem

删除对话框中容器控件中的项。

```
HRESULT RemoveControlItem(
    DWORD dwIDCtl,
    DWORD dwIDItem);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
要从中移除项的容器控件的 ID。

*dwIDItem*<br/>
项的 ID。

### <a name="remarks"></a>备注

##  <a name="setcheckbuttonstate"></a>  CFileDialog::SetCheckButtonState

设置对话框中选中按钮 (复选框) 的当前状态。

```
HRESULT SetCheckButtonState(
    DWORD dwIDCtl,
    BOOL bChecked);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
复选框的 ID。

*bChecked*<br/>
复选框的状态。 如果为 TRUE, 则表示已选中;FALSE 表示未选中。

### <a name="remarks"></a>备注

##  <a name="setcontrolitemstate"></a>CFileDialog:: SetControlItemState

设置在对话框中找到的容器控件中某项的当前状态。

```
HRESULT SetControlItemState(
    DWORD dwIDCtl,
    DWORD dwIDItem,
    CDCONTROLSTATEF dwState);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
容器控件的 ID。

*dwIDItem*<br/>
项的 ID。

*dwState*<br/>
CDCONTROLSTATE 枚举中的一个或多个值, 指示控件的新状态。

### <a name="remarks"></a>备注

##  <a name="setcontrolitemtext"></a>  CFileDialog::SetControlItemText

设置控件项的文本。 例如, 单选按钮或菜单中的项的文本。

```
HRESULT SetControlItemText(
    DWORD dwIDCtl,
    DWORD dwIDItem,
    const CString& strLabel);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
容器控件的 ID。

*dwIDItem*<br/>
项的 ID。

*strLabel*<br/>
项的文本。

### <a name="remarks"></a>备注

##  <a name="setcontrollabel"></a>CFileDialog:: SetControlLabel

设置与控件关联的文本, 例如按钮文本或编辑框标签。

```
HRESULT SetControlLabel(
    DWORD dwIDCtl,
    const CString& strLabel);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
控件的 ID。

*strLabel*<br/>
控件名称。

### <a name="remarks"></a>备注

##  <a name="setcontrolstate"></a>CFileDialog:: SetControlState

设置给定控件的当前可见性和已启用状态。

```
HRESULT SetControlState(
    DWORD dwIDCtl,
    CDCONTROLSTATEF dwState);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
控件的 ID。

*dwState*<br/>
CDCONTROLSTATE 枚举中的一个或多个值, 指示控件的当前状态。

### <a name="remarks"></a>备注

##  <a name="setcontroltext"></a>CFileDialog:: SetControlText

调用此方法可在资源管理器样式的 "**打开**" 或 "**另存为**" 对话框中设置指定控件的文本。

```
void SetControlText(
    int nID,
    LPCSTR lpsz);

void SetControlText(
    int nID,
    const wchar_t *lpsz);
```

### <a name="parameters"></a>参数

*nID*<br/>
中要为其设置文本的控件的 ID。

*lpsz*<br/>
中指向字符串的指针, 该字符串包含要为控件设置的文本。

### <a name="remarks"></a>备注

此函数的两个版本对使用 Unicode 的应用程序有效。 但是, 只有 LPCSTR 类型的版本对使用 ANSI 的应用程序有效。

若要使用此方法, 必须创建具有 OFN_EXPLORER 样式的对话框。 否则, 该函数将失败并返回一个断言。

##  <a name="setdefext"></a>CFileDialog:: SetDefExt

调用此函数可为资源管理器样式的 "打开" 或 "另存为公用" 对话框设置默认文件扩展名。

```
void SetDefExt(LPCSTR lpsz);
```

### <a name="parameters"></a>参数

*lpsz*<br/>
指向字符串的指针, 该字符串包含要用于对话框对象的默认扩展。 此字符串不得包含句点 (.)。

### <a name="remarks"></a>备注

必须已使用 OFN_EXPLORER 样式创建对话框;否则, 该函数将失败并返回一个断言。

##  <a name="seteditboxtext"></a>CFileDialog:: SetEditBoxText

设置编辑框控件中的当前文本。

```
HRESULT SetEditBoxText(
    DWORD dwIDCtl,
    const CString& strText);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
编辑框的 ID。

*strText*<br/>
文本值。

### <a name="remarks"></a>备注

##  <a name="setproperties"></a>CFileDialog:: SetProperties

提供一个属性存储，它定义将默认值用于正在保存的项。

```
BOOL SetProperties(LPCWSTR lpszPropList);
```

### <a name="parameters"></a>参数

*lpszPropList*<br/>
由“;”分隔的预定义的属性列表。 有关标志的列表, 请参阅[OPENFILENAME](/windows/win32/api/commdlg/ns-commdlg-openfilenamew)的**flags**部分。

### <a name="remarks"></a>备注

##  <a name="setselectedcontrolitem"></a>CFileDialog:: SetSelectedControlItem

设置选项按钮组或对话框中的组合框中特定项的选定状态。

```
HRESULT SetSelectedControlItem(
    DWORD dwIDCtl,
    DWORD dwIDItem);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
容器控件的 ID。

*dwIDItem*<br/>
用户在控件中选择的项的 ID。

### <a name="remarks"></a>备注

##  <a name="settemplate"></a>CFileDialog:: SetTemplate

设置[CFileDialog](../../mfc/reference/cfiledialog-class.md)对象的对话框模板。

```
void SetTemplate(
    UINT nWin3ID,
    UINT nWin4ID);

void SetTemplate(
    LPCTSTR lpWin3ID,
    LPCTSTR lpWin4ID);
```

### <a name="parameters"></a>参数

*nWin3ID*<br/>
中包含非资源管理器`CFileDialog`对象的模板资源的 ID 号。 此模板仅用于 Windows NT 3.51 或 OFN_EXPLORER 样式不存在。

*nWin4ID*<br/>
中包含资源管理器`CFileDialog`对象的模板资源的 ID 号。 此模板仅用于 Windows NT 4.0 及更高版本、Windows 95 及更高版本, 或者 OFN_EXPLORER 样式存在。

*lpWin3ID*<br/>
中包含非资源管理器`CFileDialog`对象的模板资源的名称。 此模板仅用于 Windows NT 3.51 或 OFN_EXPLORER 样式不存在。

*lpWin4ID*<br/>
中包含资源管理器`CFileDialog`对象的模板资源的名称。 此模板仅用于 Windows NT 4.0 及更高版本、Windows 95 及更高版本, 或者 OFN_EXPLORER 样式存在。

### <a name="remarks"></a>备注

系统将仅使用其中一个指定的模板。 系统根据 OFN_EXPLORER 样式的存在以及运行应用程序的操作系统来确定要使用哪个模板。 通过同时指定非资源管理器和资源管理器样式的模板, 可以轻松支持 Windows NT 3.51、Windows NT 4.0 及更高版本以及 Windows 95 及更高版本。

> [!NOTE]
> Windows Vista 或更高版本的 "样式文件" 对话框不支持此功能。 尝试在 Windows Vista 或更高版本的样式文件对话框上使用此函数将引发[CNotSupportedException](../../mfc/reference/cnotsupportedexception-class.md)。 一种替代方法是使用自定义的对话框。 有关使用自定义`CFileDialog`的详细信息, 请参阅[IFileDialogCustomize](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ifiledialogcustomize)。

##  <a name="startvisualgroup"></a>CFileDialog:: StartVisualGroup

在对话框中声明一个视觉对象组。 对任何 "add" 方法的后续调用都会向此组添加这些元素。

```
HRESULT StartVisualGroup(
    DWORD dwIDCtl,
    const CString& strLabel);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
视觉对象组的 ID。

*strLabel*<br/>
组名称。

### <a name="remarks"></a>备注

##  <a name="updateofnfromshelldialog"></a>CFileDialog:: UpdateOFNFromShellDialog

基于内部对象的当前状态更新[CFileDialog](../../mfc/reference/cfiledialog-class.md)的数据结构。`m_ofn`

```
void UpdateOFNFromShellDialog();
```

### <a name="remarks"></a>备注

在 Windows Vista 之前的 Windows 版本中, 成员[OPENFILENAME](/previous-versions/windows/embedded/ms911906\(v=msdn.10\))数据结构与的`CFileDialog`状态保持同步。 对[m_ofn](#m_ofn)成员变量所做的任何更改都会直接影响对话框的状态。 同时, 对对话框状态所做的任何更改都会立即更新 m_ofn 成员变量。

在 Windows Vista 或更高版本`m_ofn`中, 不会自动更新数据结构。 为了保证`m_ofn`成员变量中的数据准确性, 应在访问数据之前`UpdateOFNFromShellDialog`调用函数。 Windows 在[IFileDialog:: OnFileOK](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ifiledialogevents-onfileok)的处理过程中自动调用此函数。

有关如何在 Windows Vista 或更高`CFileDialog`版本下使用类的详细信息, 请参阅[CFileDialog 类](../../mfc/reference/cfiledialog-class.md)。

### <a name="example"></a>示例

此示例将在`CFileDialog`显示之前对其进行更新。 在更新`m_ofn`成员变量之前, 需要将它同步到对话框的当前状态。

[!code-cpp[NVC_MFC_CFileDialog#1](../../mfc/reference/codesnippet/cpp/cfiledialog-class_7.cpp)]

## <a name="see-also"></a>请参阅

[CCommonDialog 类](../../mfc/reference/ccommondialog-class.md)<br/>
[层次结构图](../../mfc/hierarchy-chart.md)
