---
title: CFileDialog 类
ms.date: 11/04/2016
f1_keywords:
- CFileDialog
- AFXDLGS/CFileDialog
- AFXDLGS/CFileDialog::CFileDialog
- AFXDLGS/CFileDialog::AddCheckButton
- AFXDLGS/CFileDialog::AddComboBox
- AFXDLGS/CFileDialog::AddControlItem
- AFXDLGS/CFileDialog::AddEditBox
- AFXDLGS/CFileDialog::AddMenu
- AFXDLGS/CFileDialog::AddPlace
- AFXDLGS/CFileDialog::AddPushButton
- AFXDLGS/CFileDialog::AddRadioButtonList
- AFXDLGS/CFileDialog::AddSeparator
- AFXDLGS/CFileDialog::AddText
- AFXDLGS/CFileDialog::ApplyOFNToShellDialog
- AFXDLGS/CFileDialog::DoModal
- AFXDLGS/CFileDialog::EnableOpenDropDown
- AFXDLGS/CFileDialog::EndVisualGroup
- AFXDLGS/CFileDialog::GetCheckButtonState
- AFXDLGS/CFileDialog::GetControlItemState
- AFXDLGS/CFileDialog::GetControlState
- AFXDLGS/CFileDialog::GetEditBoxText
- AFXDLGS/CFileDialog::GetFileExt
- AFXDLGS/CFileDialog::GetFileName
- AFXDLGS/CFileDialog::GetFileTitle
- AFXDLGS/CFileDialog::GetFolderPath
- AFXDLGS/CFileDialog::GetIFileDialogCustomize
- AFXDLGS/CFileDialog::GetIFileOpenDialog
- AFXDLGS/CFileDialog::GetIFileSaveDialog
- AFXDLGS/CFileDialog::GetNextPathName
- AFXDLGS/CFileDialog::GetOFN
- AFXDLGS/CFileDialog::GetPathName
- AFXDLGS/CFileDialog::GetReadOnlyPref
- AFXDLGS/CFileDialog::GetResult
- AFXDLGS/CFileDialog::GetResults
- AFXDLGS/CFileDialog::GetSelectedControlItem
- AFXDLGS/CFileDialog::GetStartPosition
- AFXDLGS/CFileDialog::HideControl
- AFXDLGS/CFileDialog::IsPickFoldersMode
- AFXDLGS/CFileDialog::MakeProminent
- AFXDLGS/CFileDialog::RemoveControlItem
- AFXDLGS/CFileDialog::SetCheckButtonState
- AFXDLGS/CFileDialog::SetControlItemState
- AFXDLGS/CFileDialog::SetControlItemText
- AFXDLGS/CFileDialog::SetControlLabel
- AFXDLGS/CFileDialog::SetControlState
- AFXDLGS/CFileDialog::SetControlText
- AFXDLGS/CFileDialog::SetDefExt
- AFXDLGS/CFileDialog::SetEditBoxText
- AFXDLGS/CFileDialog::SetProperties
- AFXDLGS/CFileDialog::SetSelectedControlItem
- AFXDLGS/CFileDialog::SetTemplate
- AFXDLGS/CFileDialog::StartVisualGroup
- AFXDLGS/CFileDialog::UpdateOFNFromShellDialog
- AFXDLGS/CFileDialog::OnButtonClicked
- AFXDLGS/CFileDialog::OnCheckButtonToggled
- AFXDLGS/CFileDialog::OnControlActivating
- AFXDLGS/CFileDialog::OnFileNameChange
- AFXDLGS/CFileDialog::OnFileNameOK
- AFXDLGS/CFileDialog::OnFolderChange
- AFXDLGS/CFileDialog::OnInitDone
- AFXDLGS/CFileDialog::OnItemSelected
- AFXDLGS/CFileDialog::OnLBSelChangedNotify
- AFXDLGS/CFileDialog::OnShareViolation
- AFXDLGS/CFileDialog::OnTypeChange
- AFXDLGS/CFileDialog::m_ofn
helpviewer_keywords:
- CFileDialog [MFC], CFileDialog
- CFileDialog [MFC], AddCheckButton
- CFileDialog [MFC], AddComboBox
- CFileDialog [MFC], AddControlItem
- CFileDialog [MFC], AddEditBox
- CFileDialog [MFC], AddMenu
- CFileDialog [MFC], AddPlace
- CFileDialog [MFC], AddPushButton
- CFileDialog [MFC], AddRadioButtonList
- CFileDialog [MFC], AddSeparator
- CFileDialog [MFC], AddText
- CFileDialog [MFC], ApplyOFNToShellDialog
- CFileDialog [MFC], DoModal
- CFileDialog [MFC], EnableOpenDropDown
- CFileDialog [MFC], EndVisualGroup
- CFileDialog [MFC], GetCheckButtonState
- CFileDialog [MFC], GetControlItemState
- CFileDialog [MFC], GetControlState
- CFileDialog [MFC], GetEditBoxText
- CFileDialog [MFC], GetFileExt
- CFileDialog [MFC], GetFileName
- CFileDialog [MFC], GetFileTitle
- CFileDialog [MFC], GetFolderPath
- CFileDialog [MFC], GetIFileDialogCustomize
- CFileDialog [MFC], GetIFileOpenDialog
- CFileDialog [MFC], GetIFileSaveDialog
- CFileDialog [MFC], GetNextPathName
- CFileDialog [MFC], GetOFN
- CFileDialog [MFC], GetPathName
- CFileDialog [MFC], GetReadOnlyPref
- CFileDialog [MFC], GetResult
- CFileDialog [MFC], GetResults
- CFileDialog [MFC], GetSelectedControlItem
- CFileDialog [MFC], GetStartPosition
- CFileDialog [MFC], HideControl
- CFileDialog [MFC], IsPickFoldersMode
- CFileDialog [MFC], MakeProminent
- CFileDialog [MFC], RemoveControlItem
- CFileDialog [MFC], SetCheckButtonState
- CFileDialog [MFC], SetControlItemState
- CFileDialog [MFC], SetControlItemText
- CFileDialog [MFC], SetControlLabel
- CFileDialog [MFC], SetControlState
- CFileDialog [MFC], SetControlText
- CFileDialog [MFC], SetDefExt
- CFileDialog [MFC], SetEditBoxText
- CFileDialog [MFC], SetProperties
- CFileDialog [MFC], SetSelectedControlItem
- CFileDialog [MFC], SetTemplate
- CFileDialog [MFC], StartVisualGroup
- CFileDialog [MFC], UpdateOFNFromShellDialog
- CFileDialog [MFC], OnButtonClicked
- CFileDialog [MFC], OnCheckButtonToggled
- CFileDialog [MFC], OnControlActivating
- CFileDialog [MFC], OnFileNameChange
- CFileDialog [MFC], OnFileNameOK
- CFileDialog [MFC], OnFolderChange
- CFileDialog [MFC], OnInitDone
- CFileDialog [MFC], OnItemSelected
- CFileDialog [MFC], OnLBSelChangedNotify
- CFileDialog [MFC], OnShareViolation
- CFileDialog [MFC], OnTypeChange
- CFileDialog [MFC], m_ofn
ms.assetid: fda4fd3c-08b8-4ce0-8e9d-7bab23f8c6c0
ms.openlocfilehash: f74d883fa0dcdce025345848caf49069736ee0fa
ms.sourcegitcommit: c7f90df497e6261764893f9cc04b5d1f1bf0b64b
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/05/2019
ms.locfileid: "58779204"
---
# <a name="cfiledialog-class"></a>CFileDialog 类

封装用于打开文件或保存操作的文件的公共对话框。

## <a name="syntax"></a>语法

```
class CFileDialog : public CCommonDialog
```

## <a name="members"></a>成员

### <a name="public-constructors"></a>公共构造函数

|名称|描述|
|----------|-----------------|
|[CFileDialog::CFileDialog](#cfiledialog)|构造 `CFileDialog` 对象。|

### <a name="public-methods"></a>公共方法

|名称|描述|
|----------|-----------------|
|[CFileDialog::AddCheckButton](#addcheckbutton)|向对话框中勾选按钮。|
|[CFileDialog::AddComboBox](#addcombobox)|将组合框添加到对话框。|
|[CFileDialog::AddControlItem](#addcontrolitem)|将项添加到对话框中的容器控件。|
|[CFileDialog::AddEditBox](#addeditbox)|将编辑框添加到对话框。|
|[CFileDialog::AddMenu](#addmenu)|将菜单添加到对话框。|
|[CFileDialog::AddPlace](#addplace)|已重载。 将添加到列表中的文件夹将放置可供用户打开或保存项。|
|[CFileDialog::AddPushButton](#addpushbutton)|将按钮添加到对话框。|
|[CFileDialog::AddRadioButtonList](#addradiobuttonlist)|将选项按钮 （也称为单选按钮） 组添加到对话框。|
|[CFileDialog::AddSeparator](#addseparator)|向对话框添加分隔符。|
|[CFileDialog::AddText](#addtext)|向对话框添加文本内容。|
|[CFileDialog::ApplyOFNToShellDialog](#applyofntoshelldialog)|将更新的状态`CFileDialog`以匹配的参数和标志中存储`m_ofn`成员变量。|
|[CFileDialog::DoModal](#domodal)|显示对话框中，并使用户能够进行选择。|
|[CFileDialog::EnableOpenDropDown](#enableopendropdown)|启用上的下拉列表**开放**或**保存**对话框中的按钮。|
|[CFileDialog::EndVisualGroup](#endvisualgroup)|停止在添加到对话框中的 visual 组元素。|
|[CFileDialog::GetCheckButtonState](#getcheckbuttonstate)|获取对话框中的复选按钮 （复选框） 的当前状态。|
|[CFileDialog::GetControlItemState](#getcontrolitemstate)|获取在对话框中找到的容器控件中的项的当前状态。|
|[CFileDialog::GetControlState](#getcontrolstate)|获取当前可见性，并已启用的给定控件的状态。|
|[CFileDialog::GetEditBoxText](#geteditboxtext)|获取当前文本中的编辑框控件。|
|[CFileDialog::GetFileExt](#getfileext)|返回所选文件的扩展名。|
|[CFileDialog::GetFileName](#getfilename)|返回所选文件的文件名。|
|[CFileDialog::GetFileTitle](#getfiletitle)|返回所选文件的标题。|
|[CFileDialog::GetFolderPath](#getfolderpath)|检索当前打开的文件夹或目录的路径的资源管理器样式**打开**或**另存为**公共对话框。|
|[CFileDialog::GetIFileDialogCustomize](#getifiledialogcustomize)|检索自定义的内部 COM 对象`CFileDialog`对象。|
|[CFileDialog::GetIFileOpenDialog](#getifileopendialog)|检索的内部 COM 对象`CFileDialog`用作**打开**文件对话框。|
|[CFileDialog::GetIFileSaveDialog](#getifilesavedialog)|检索的内部 COM 对象`CFileDialog`用作**保存**文件对话框。|
|[CFileDialog::GetNextPathName](#getnextpathname)|返回下一步所选文件的完整路径。|
|[CFileDialog::GetOFN](#getofn)|检索`OPENFILENAME`结构的`CFileDialog`对象。|
|[CFileDialog::GetPathName](#getpathname)|返回所选文件的完整路径。|
|[CFileDialog::GetReadOnlyPref](#getreadonlypref)|返回所选文件的只读状态。|
|[CFileDialog::GetResult](#getresult)|获取用户在对话框中所做的选择。|
|[CFileDialog::GetResults](#getresults)|在一个对话框，允许多个所选内容中获取用户的选择。|
|[CFileDialog::GetSelectedControlItem](#getselectedcontrolitem)|获取从指定的容器控件在对话框中特定项。|
|[CFileDialog::GetStartPosition](#getstartposition)|返回文件名称列表的第一个元素的位置。|
|[CFileDialog::HideControl](#hidecontrol)|隐藏指定的控件中的资源管理器样式**开放**或**另存为**公共对话框。|
|[CFileDialog::IsPickFoldersMode](#ispickfoldersmode)|确定是否在文件夹选取器模式下当前的对话框。|
|[CFileDialog::MakeProminent](#makeprominent)|位置的控件在对话框中，以便它更醒目相比其他已添加的控件。|
|[CFileDialog::RemoveControlItem](#removecontrolitem)|从对话框中的容器控件中移除的项。|
|[CFileDialog::SetCheckButtonState](#setcheckbuttonstate)|在对话框中设置复选按钮 （复选框） 的当前的状态。|
|[CFileDialog::SetControlItemState](#setcontrolitemstate)|设置在对话框中找到容器控件中项的当前状态。|
|[CFileDialog::SetControlItemText](#setcontrolitemtext)|设置控件项的文本。 例如，附带的单选按钮或菜单中的项的文本。|
|[CFileDialog::SetControlLabel](#setcontrollabel)|设置按钮文本或编辑框标签等控件，与关联的文本。|
|[CFileDialog::SetControlState](#setcontrolstate)|设置当前可见性，并已启用的给定控件的状态。|
|[CFileDialog::SetControlText](#setcontroltext)|在资源管理器样式设置为指定的控件的文本**开放**或**另存为**公共对话框。|
|[CFileDialog::SetDefExt](#setdefext)|设置资源管理器样式的默认文件扩展名**开放**或**另存为**公共对话框。|
|[CFileDialog::SetEditBoxText](#seteditboxtext)|在编辑框控件中设置的当前文本。|
|[CFileDialog::SetProperties](#setproperties)|提供一个属性存储，它定义将默认值用于正在保存的项。|
|[CFileDialog::SetSelectedControlItem](#setselectedcontrolitem)|选项按钮组或在对话框中找到一个组合框中设置特定项的选定的状态。|
|[CFileDialog::SetTemplate](#settemplate)|设置的对话框模板`CFileDialog`对象。|
|[CFileDialog::StartVisualGroup](#startvisualgroup)|在对话框中将 visual 组声明。 对任何"add"方法的后续调用将这些元素添加到此组。|
|[CFileDialog::UpdateOFNFromShellDialog](#updateofnfromshelldialog)|更新中存储的数据`m_ofn`成员变量，以匹配文件对话框中的当前状态。|

### <a name="protected-methods"></a>受保护的方法

|名称|描述|
|----------|-----------------|
|[CFileDialog::OnButtonClicked](#onbuttonclicked)|当单击该按钮时调用。|
|[CFileDialog::OnCheckButtonToggled](#oncheckbuttontoggled)|选中/取消选中复选框时调用。|
|[CFileDialog::OnControlActivating](#oncontrolactivating)|当控件处于活动状态时调用。|
|[CFileDialog::OnFileNameChange](#onfilenamechange)|处理 WM_NOTIFY CDN_SELCHANGE 消息。|
|[CFileDialog::OnFileNameOK](#onfilenameok)|验证在对话框中输入的文件名称。|
|[CFileDialog::OnFolderChange](#onfolderchange)|处理 WM_NOTIFY CDN_FOLDERCHANGE 消息。|
|[CFileDialog::OnInitDone](#oninitdone)|处理 WM_NOTIFY CDN_INITDONE 消息。|
|[CFileDialog::OnItemSelected](#onitemselected)|正在选择容器项时调用。|
|[CFileDialog::OnLBSelChangedNotify](#onlbselchangednotify)|可以选择文件发生更改时执行自定义操作。|
|[CFileDialog::OnShareViolation](#onshareviolation)|句柄共享冲突。|
|[CFileDialog::OnTypeChange](#ontypechange)|处理 WM_NOTIFY CDN_TYPECHANGE 消息。|

### <a name="public-data-members"></a>公共数据成员

|名称|描述|
|----------|-----------------|
|[CFileDialog::m_ofn](#m_ofn)|Windows`OPENFILENAME`结构。 提供对基本文件对话框的参数的访问。|

## <a name="remarks"></a>备注

公共文件对话框使您可以实现文件选择对话框框中，例如，**打开的文件**并**另存为**，以与 Windows 标准一致的方式。

可以使用`CFileDialog`按原样提供构造函数提供，也可以派生您自己对话框类从`CFileDialog`和编写构造函数以满足你的需求。 在任一情况下，这些对话框的行为类似于标准 MFC 对话框因为派生自[CCommonDialog 类](../../mfc/reference/ccommondialog-class.md)。 `CFileDialog` 依赖于 COMMDLG。在 Windows 中包含的 DLL 文件。

外观和功能`CFileDialog`与 Windows Vista 或更高版本不同于 Windows 早期版本。 默认值`CFileDialog`如果程序是已编译和运行 Windows vista 或更高版本会自动使用新的 Windows Vista 或更高版本的样式，无需更改代码。 使用*bVistaStyle*构造函数，以便手动重写此自动更新中的参数。 自动更新的例外是自定义的对话框。 它们不会转换为新样式。 有关构造函数的详细信息，请参阅[CFileDialog::CFileDialog](#cfiledialog)。

> [!NOTE]
>  控件 ID 系统与在 Windows Vista 或更高版本的 Windows 的早期版本中使用时`CFileDialog`。 必须更新所有引用`CFileDialog`代码之前可以移植将项目从早期版本的 Windows 中的控件。

某些`CFileDialog`方法不支持 Windows vista 或更高版本。 检查各个方法主题，了解有关是否支持该方法的信息。 此外，Windows vista 或更高版本不支持以下继承的函数：

- [CDialog::OnInitDialog](../../mfc/reference/cdialog-class.md#oninitdialog)

- [CDialog::OnSetFont](../../mfc/reference/cdialog-class.md#onsetfont)

为 windows 消息`CFileDialog`类差异取决于正在使用什么操作系统。 例如，Windows XP 不支持[CDialog::OnCancel](../../mfc/reference/cdialog-class.md#oncancel)并[CDialog::OnOK](../../mfc/reference/cdialog-class.md#onok)为`CFileDialog`类。 但是，Windows Vista 和更高版本操作系统支持它们。 有关生成的不同消息和接收它们的顺序的详细信息，请参阅[CFileDialog 示例：日志记录事件的顺序](../../overview/visual-cpp-samples.md)。

若要使用`CFileDialog`对象，请首先创建该对象使用`CFileDialog`构造函数。 已构造对话框的后，可以设置或修改中的任何值[CFileDialog::m_ofn](#m_ofn)结构初始化的值或对话框控件的状态。 `m_ofn`类型的结构是`OPENFILENAME`。 有关详细信息，请参阅[OPENFILENAME](/windows/desktop/api/commdlg/ns-commdlg-tagofna) Windows SDK 中的结构。

初始化对话框控件后，调用[CFileDialog::DoModal](#domodal)方法来显示对话框框，以便用户可以键入路径和文件名称。 `DoModal` 返回用户是否单击确定 (IDOK) 或取消 (IDCANCEL) 按钮。 如果`DoModal`返回 IDOK，您可以使用其中一个`CFileDialog`公共成员函数来检索该信息放入该用户。

> [!NOTE]
> Windows vista 或更高版本，多次调用[IFileDialog::SetFileTypes](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ifiledialog-setfiletypes)将导致错误。 第二次调用`SetFileTypes`的任何实例`CFileDialog`将返回 E_UNEXPECTED 在 Windows Vista 或更高版本。 某些`CFileDialog`方法函数会调用`SetFileTypes`。 例如，两次调用`CFileDialog::DoModal`的相同实例`CFileDialog`生成[ASSERT](diagnostic-services.md#assert)。

`CFileDialog` 包含使您能够执行共享冲突，文件名称验证和列表框中更改通知的自定义处理的多个受保护的成员。 这些受保护的成员都是大多数应用程序无需使用，因为默认处理自动执行的回调函数。 不需要这些函数的消息映射条目，因为它们是标准的虚拟函数。

可以使用 Windows [CommDlgExtendedError](/windows/desktop/api/commdlg/nf-commdlg-commdlgextendederror)函数来确定在对话框中的初始化过程中是否发生了错误并了解有关错误的详细信息。

析构`CFileDialog`自动处理对象。 无需调用[CDialog::EndDialog](../../mfc/reference/cdialog-class.md#enddialog)。

若要允许用户选择多个文件，然后再调用设置 OFN_ALLOWMULTISELECT 标志`DoModal`。 必须提供你自己的文件名称缓冲区以容纳返回的多个文件名的列表。 执行此操作通过替换`m_ofn.lpstrFile`指向的缓冲区与你已分配之后您构造, `CFileDialog`，但在调用之前`DoModal`。

此外，必须设置`m_ofn.nMaxFile`指向的缓冲区中使用的字符数`m_ofn.lpstrFile`。 如果设置为选择文件的最大数目`n`，所需的缓冲区大小是`n * (_MAX_PATH + 1) + 1`。 缓冲区中返回的第一项是选中其中的文件的文件夹的路径。 有关 Windows Vista 或更高版本样式对话框中，目录和文件名称字符串是以 null 终止的具有一个额外的 null 字符之后的最后一个文件名称。 此格式支持资源管理器样式对话框以返回包含空格的长文件名。 对于旧式对话框框中，由空格分隔的目录和文件名称字符串和使用空间，该函数使用的文件名称的短文件名。

下面的示例演示如何使用缓冲区来检索并列出多个文件的名称。

[!code-cpp[NVC_MFCFiles#23](../../atl-mfc-shared/reference/codesnippet/cpp/cfiledialog-class_1.cpp)]

若要更改的缓冲区大小，以响应用户选择多个文件的名称，必须派生新类从`CFileDialog`并重写[CFileDialog::OnFileNameChange](#onfilenamechange)方法。

如果类派生新类从`CFileDialog`，可以使用消息映射来处理任何消息。 若要扩展的默认消息处理，从派生类`CFileDialog`、 将消息映射添加到新的类，并为新的消息提供成员函数。 无需提供挂钩函数，以自定义对话框。

若要自定义对话框中，派生的类从`CFileDialog`，提供自定义对话框模板，并添加消息映射来处理从扩展控件的通知消息。 将任何未处理的消息传递给类的基类。 不需要自定义挂钩函数。

当使用 Windows Vista 或更高版本的样式`CFileDialog`，不能使用消息映射和对话框模板。 相反，您必须获得类似的功能使用 COM 接口。

有关如何使用详细信息`CFileDialog`，请参阅[通用对话框类](../../mfc/common-dialog-classes.md)。

## <a name="inheritance-hierarchy"></a>继承层次结构

[CObject](../../mfc/reference/cobject-class.md)

[CCmdTarget](../../mfc/reference/ccmdtarget-class.md)

[CWnd](../../mfc/reference/cwnd-class.md)

[CDialog](../../mfc/reference/cdialog-class.md)

[CCommonDialog](../../mfc/reference/ccommondialog-class.md)

`CFileDialog`

## <a name="requirements"></a>要求

**标头：** afxdlgs.h

##  <a name="addcheckbutton"></a>  CFileDialog::AddCheckButton

向对话框中勾选按钮。

```
HRESULT AddCheckButton(
    DWORD dwIDCtl,
    const CString& strLabel,
    BOOL bChecked);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
要添加检查按钮的 ID。

*strLabel*<br/>
检查按钮名称。

*bChecked*<br/>
布尔值，该值指示检查按钮的当前状态。 如果选中，则为 TRUEFALSE 否则为

### <a name="remarks"></a>备注

##  <a name="addcombobox"></a>  CFileDialog::AddComboBox

将组合框添加到对话框。

```
HRESULT AddComboBox(DWORD dwIDCtl);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
要添加的组合框的 ID。

### <a name="remarks"></a>备注

##  <a name="addcontrolitem"></a>  CFileDialog::AddControlItem

将项添加到对话框中的容器控件。

```
HRESULT AddControlItem(
    DWORD dwIDCtl,
    DWORD dwIDItem,
    const CString& strLabel);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
要将项添加到容器控件的 ID。

*dwIDItem*<br/>
项的 ID。

*strLabel*<br/>
项的文本。

### <a name="remarks"></a>备注

##  <a name="addeditbox"></a>  CFileDialog::AddEditBox

将编辑框添加到对话框。

```
HRESULT AddEditBox(
    DWORD dwIDCtl,
    const CString& strText);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
要添加的编辑框的 ID。

*strText*<br/>
编辑框名称。

### <a name="remarks"></a>备注

##  <a name="addmenu"></a>  CFileDialog::AddMenu

将菜单添加到对话框。

```
HRESULT AddMenu(
    DWORD dwIDCtl,
    const CString& strLabel);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
若要添加菜单的 ID。

*strLabel*<br/>
菜单名称。

### <a name="remarks"></a>备注

##  <a name="addplace"></a>  CFileDialog::AddPlace

将添加到列表中的文件夹将放置可供用户打开或保存项。

```
void AddPlace(
    LPCWSTR lpszFolder,
    FDAP fdap = FDAP_TOP) throw();

void AddPlace(
    IShellItem* psi,
    FDAP fdap = FDAP_TOP) throw();
```

### <a name="parameters"></a>参数

*lpszFolder*<br/>
若要可提供给用户的文件夹路径。 这只能是一个文件夹。

*fdap*<br/>
指定在文件夹列表中的放置位置。

*psi*<br/>
表示要可提供给用户的文件夹 IShellItem 指向的指针。 这只能是一个文件夹。

### <a name="remarks"></a>备注

##  <a name="addpushbutton"></a>  CFileDialog::AddPushButton

将按钮添加到对话框。

```
HRESULT AddPushButton(
    DWORD dwIDCtl,
    const CString& strLabel);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
要添加的按钮的 ID。

*strLabel*<br/>
按钮名称。

### <a name="remarks"></a>备注

##  <a name="addradiobuttonlist"></a>  CFileDialog::AddRadioButtonList

将选项按钮 （也称为单选按钮） 组添加到对话框。

```
HRESULT AddRadioButtonList(DWORD dwIDCtl);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
要添加的选项按钮组的 ID。

### <a name="remarks"></a>备注

##  <a name="addseparator"></a>  CFileDialog::AddSeparator

向对话框添加分隔符。

```
HRESULT AddSeparator(DWORD dwIDCtl);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
添加分隔符的 ID。

### <a name="remarks"></a>备注

##  <a name="addtext"></a>  CFileDialog::AddText

将文本添加到对话框。

```
HRESULT AddText(
    DWORD dwIDCtl,
    const CString& strText);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
要添加的文本的 ID。

*strText*<br/>
文本名称。

### <a name="remarks"></a>备注

##  <a name="applyofntoshelldialog"></a>  CFileDialog::ApplyOFNToShellDialog

更新的当前状态[CFileDialog](../../mfc/reference/cfiledialog-class.md)基于中存储的值`m_ofn`数据结构。

```
void ApplyOFNToShellDialog();
```

### <a name="remarks"></a>备注

在 Windows Vista，该成员之前的 Windows 版本[OPENFILENAME](https://msdn.microsoft.com/library/ms911906.aspx)持续的状态同步数据结构`CFileDialog`。 对任何更改[m_ofn](#m_ofn)成员变量都立即反映在对话框中的状态。 此外，对对话框的状态的任何更改立即更新`m_ofn`成员变量。

在 Windows Vista 或更高版本中的值`m_ofn`成员变量和状态`CFileDialog`不保证能够同步。 此函数会强制状态`CFileDialog`若要更新以匹配`m_ofn`结构。 Windows 将调用此函数过程中自动[CFileDialog::DoModal](#domodal)。

有关如何使用详细信息`CFileDialog`类在 Windows Vista 或更高版本，请参阅[CFileDialog 类](../../mfc/reference/cfiledialog-class.md)。

### <a name="example"></a>示例

  有关示例，请参阅[CFileDialog::UpdateOFNFromShellDialog](#updateofnfromshelldialog)。

##  <a name="cfiledialog"></a>  CFileDialog::CFileDialog

调用此函数来构造一个标准的 Windows 文件对话框。

```
explicit CFileDialog(
    BOOL bOpenFileDialog,
    LPCTSTR lpszDefExt = NULL,
    LPCTSTR lpszFileName = NULL,
    DWORD dwFlags = OFN_HIDEREADONLY | OFN_OVERWRITEPROMPT,
    LPCTSTR lpszFilter = NULL,
    CWnd* pParentWnd = NULL,
    DWORD dwSize = 0,
    BOOL bVistaStyle = TRUE);
```

### <a name="parameters"></a>参数

*bOpenFileDialog*<br/>
[in]此参数指定哪种类型的对话框来创建。 将其设置为 TRUE 来构造**文件打开**对话框。 将其设置为 FALSE 来构造**文件另存为**对话框。

*lpszDefExt*<br/>
[in]默认文件扩展名。 如果用户不在文件名框中包含的已知的扩展 （一个用户的计算机上未关联），指定的扩展*lpszDefExt*自动追加到的文件的名称。 如果此参数为 NULL，将追加没有扩展名。

*lpszFileName*<br/>
[in]在文件名框中显示的初始文件名称。 如果为 NULL，则会不显示任何初始文件名称。

*dwFlags*<br/>
[in]可用于自定义对话框中的一个或多个标志的组合。 有关这些标志的说明，请参阅[OPENFILENAME](/windows/desktop/api/commdlg/ns-commdlg-tagofna) Windows SDK 中的结构。 如果您修改`m_ofn.Flags`结构成员，请使用按位 OR 运算符中所做的更改保持不变的默认行为。

*lpszFilter*<br/>
[in]指定筛选器的字符串对一系列你可以应用于文件。 如果指定文件筛选器，只有与筛选条件匹配的文件会在文件列表中。 请参阅有关如何使用文件筛选器的详细信息备注部分。

*pParentWnd*<br/>
[in]指向文件对话框的父级或所有者窗口的指针。

*dwSize*<br/>
[in]大小`OPENFILENAME`结构。 此值取决于操作系统版本。 MFC 使用此参数确定适当类型的对话框来创建。 默认大小为 0 表示 MFC 代码将确定要使用的正确对话框框大小基于在其运行该程序的操作系统版本。

*bVistaStyle*<br/>
[in]**注意**此参数在 Visual Studio 2008 和更高版本，将会导致只有运行在 Windows Vista 或更高版本才能使用新样式对话框。

此参数指定文件对话框的样式。 将其设置为 true 将使用新的 Vista 样式的文件对话框。 否则，将使用旧样式的对话框。 请参阅备注部分的详细信息 Vista 下运行。

### <a name="remarks"></a>备注

任一**文件打开**或**另存为文件**构造对话框时，具体取决于值*bOpenFileDialog*。

指定默认扩展插件使用*lpszDefExt*可能生成所需的行为，因为它是很少可预测有哪些扩展用户的计算机上具有文件关联。 如果需要更好地控制追加的默认扩展插件，可以派生您自己的类从`CFileDialog`，并替代`CFileDialog::OnFileNameOK`方法来执行您自己的扩展处理。

若要使用户能够选择多个文件，将在调用之前设置 OFN_ALLOWMULTISELECT 标志[DoModal](#domodal)。 必须提供你自己文件名缓冲区来存储返回的多个文件名的列表。 执行此操作通过替换`m_ofn.lpstrFile`指向的缓冲区与你已分配之后您构造, [CFileDialog](../../mfc/reference/cfiledialog-class.md)，但在调用之前`DoModal`。 此外，必须设置`m_ofn.nMaxFile`指向的缓冲区中的字符数`m_ofn.lpstrFile`。 如果设置为选择文件的最大数目*n*，必要的缓冲区大小是`n`*(_MAX_PATH + 1) + 1。 例如：

[!code-cpp[NVC_MFCFiles#23](../../atl-mfc-shared/reference/codesnippet/cpp/cfiledialog-class_1.cpp)]

若要使用户能够通过使用鼠标或键盘来调整大小资源管理器样式对话框，设置 OFN_ENABLESIZING 标志。 设置此标志才是必需提供挂钩过程或自定义模板。 该标志仅适用于资源管理器样式对话框;不能调整访问旧样式对话框的大小。

*LpszFilter*参数用于确定文件必须具有要显示的文件列表中的文件名称的类型。 字符串对中的第一个字符串描述筛选器;第二个字符串指示要使用的文件扩展名。 可通过使用分号 （; 字符） 作为分隔符指定多个扩展。 具有两个结尾的字符串&#124;字符后, 跟 NULL 字符。 此外可以使用[CString](../../atl-mfc-shared/using-cstring.md)为此参数的对象。

例如，Microsoft Excel 允许用户打开具有扩展.xlc （图表） 或.xls （工作表），以及其他文件。 用于 Excel 的筛选器可写为：

[!code-cpp[NVC_MFCFiles#24](../../atl-mfc-shared/reference/codesnippet/cpp/cfiledialog-class_2.cpp)]

但是，如果你打算使用此字符串到直接更新`OPENFILENAME`结构，应分隔 null 字符，而不是垂直图条 \0 字符串 (&#124;)。

*BVistaStyle*仅当运行 Windows vista 或更高版本时，参数才适用。 在早期版本的 Windows，则忽略此参数。 如果*bVistaStyle*设置为 TRUE，当编译的程序与 Visual Studio 2008 或更高版本，新的 Vista 样式**文件对话框**将使用。 否则为上一个 MFC 样式**文件对话框**将使用。

对话框模板不支持基于的对话框上*bVistaStyle*

### <a name="example"></a>示例

  有关示例，请参阅[CFileDialog::DoModal](#domodal)。

##  <a name="domodal"></a>  CFileDialog::DoModal

调用此函数以显示 Windows 公共文件对话框并允许用户浏览文件和目录，然后输入文件名。

```
virtual INT_PTR DoModal();
```

### <a name="return-value"></a>返回值

IDOK 或 IDCANCEL。 如果返回 IDCANCEL，则调用 Windows [CommDlgExtendedError](/windows/desktop/api/commdlg/nf-commdlg-commdlgextendederror)函数来确定是否发生了错误。

IDOK 和 IDCANCEL 是常数，用于指示是否在用户选择了确定或取消按钮。

### <a name="remarks"></a>备注

如果你想要通过设置的成员初始化的各种文件对话框选项`m_ofn`结构，应执行此操作之前调用`DoModal`，但在构造对话框对象之后。

例如，如果你想要允许用户选择多个文件，设置之前，调用 OFN_ALLOWMULTISELECT 标志`DoModal`，本主题中的代码示例中所示。

当用户单击对话框的确定或取消按钮或选择关闭选项对话框中从控件菜单时，则将控制返回到你的应用程序。 您然后可以调用其他成员函数来设置或信息检索用户输入到对话框。

`DoModal` 是从类中重写虚函数`CDialog`。

### <a name="example"></a>示例

[!code-cpp[NVC_MFCFiles#25](../../atl-mfc-shared/reference/codesnippet/cpp/cfiledialog-class_3.cpp)]

##  <a name="enableopendropdown"></a>  CFileDialog::EnableOpenDropDown

可以在打开或保存在对话框中的按钮的下拉列表。

```
HRESULT EnableOpenDropDown(DWORD dwIDCtl);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
下拉列表的 ID。

### <a name="remarks"></a>备注

##  <a name="endvisualgroup"></a>  CFileDialog::EndVisualGroup

停止在添加到对话框中的 visual 组元素。

```
HRESULT EndVisualGroup();
```

### <a name="return-value"></a>返回值

如果成功，则为 S_OK 返回否则为错误值。

### <a name="remarks"></a>备注

##  <a name="getcheckbuttonstate"></a>  CFileDialog::GetCheckButtonState

检索对话框中的复选按钮 （复选框） 的当前状态。

```
HRESULT GetCheckButtonState(
    DWORD dwIDCtl,
    BOOL& bChecked);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
复选框的 ID。

*bChecked*<br/>
复选框的状态。 TRUE 表示选中;FALSE 表示未选中状态。

### <a name="remarks"></a>备注

##  <a name="getcontrolitemstate"></a>  CFileDialog::GetControlItemState

检索在对话框中找到的容器控件中的项的当前状态。

```
HRESULT GetControlItemState(
    DWORD dwIDCtl,
    DWORD dwIDItem,
    CDCONTROLSTATEF& dwState);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
容器控件的 ID。

*dwIDItem*<br/>
项的 ID。

*dwState*<br/>
对一个变量来接收多个值之一，该值指示控件的当前状态 CDCONTROLSTATE 枚举中的引用。

### <a name="remarks"></a>备注

##  <a name="getcontrolstate"></a>  CFileDialog::GetControlState

检索当前可见性，并已启用的给定控件的状态。

```
HRESULT GetControlState(
    DWORD dwIDCtl,
    CDCONTROLSTATEF& dwState);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
控件的 ID。

*dwState*<br/>
对一个变量来接收来自 CDCONTROLSTATE 枚举，指示该控件的当前状态的一个或多个值的引用。

### <a name="remarks"></a>备注

##  <a name="geteditboxtext"></a>  CFileDialog::GetEditBoxText

检索一个编辑框控件中的当前文本。

```
HRESULT GetEditBoxText(
    DWORD dwIDCtl,
    CString& strText);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
编辑框的 ID。

*strText*<br/>
文本值。

### <a name="remarks"></a>备注

##  <a name="getfileext"></a>  CFileDialog::GetFileExt

调用此函数可检索到对话框中输入的文件名的扩展名。

```
CString GetFileExt() const;
```

### <a name="return-value"></a>返回值

文件名的扩展名。

### <a name="remarks"></a>备注

例如，如果输入文件的名称是数据。TXT、`GetFileExt`返回"TXT"。

如果`m_ofn.Flags`OFN_ALLOWMULTISELECT 标志设置，此字符串包含一系列以 null 结尾的字符串，被选中，该文件组的目录路径的第一个字符串与跟由用户选择的所有文件的名称。 若要检索文件路径名，请使用[GetStartPosition](#getstartposition)并[GetNextPathName](#getnextpathname)成员函数。

##  <a name="getfilename"></a>  CFileDialog::GetFileName

调用此函数可检索对话框框中输入的文件名的名称。

```
CString GetFileName() const;
```

### <a name="return-value"></a>返回值

文件的名称。

### <a name="remarks"></a>备注

文件的名称中包含的前缀和扩展。 例如，`GetFileName`将返回"文本。DAT"C:\FILES\TEXT.DAT 的文件。

如果`m_ofn.Flags`已`OFN_ALLOWMULTISELECT`标志设置，应调用[GetStartPosition](#getstartposition)并[GetNextPathName](#getnextpathname)检索文件路径名。

##  <a name="getfiletitle"></a>  CFileDialog::GetFileTitle

调用此函数可检索对话框框中输入文件的标题。

```
CString GetFileTitle() const;
```

### <a name="return-value"></a>返回值

文件的标题。

### <a name="remarks"></a>备注

文件的标题中包含仅其前缀，没有路径或扩展名。 例如，`GetFileTitle`将返回文件 C:\FILES\TEXT.DAT"TEXT"。

如果`m_ofn.Flags`OFN_ALLOWMULTISELECT 标志设置，此字符串包含一系列以 null 结尾的字符串，被选中，该文件组的目录路径的第一个字符串与跟由用户选择的所有文件的名称。 出于此原因，使用[GetStartPosition](#getstartposition)并[GetNextPathName](#getnextpathname)成员函数以检索列表中的下一个文件名。

### <a name="example"></a>示例

  有关示例，请参阅[CFileDialog::DoModal](#domodal)。

##  <a name="getfolderpath"></a>  CFileDialog::GetFolderPath

调用此成员函数以检索当前打开的文件夹或资源管理器样式打开或另存为的通用对话框的目录的路径。

```
CString GetFolderPath() const;
```

### <a name="return-value"></a>返回值

一个[CString](../../atl-mfc-shared/reference/cstringt-class.md)对象，其中包含当前打开的文件夹或目录。

### <a name="remarks"></a>备注

必须为对话框中创建的 OFN_EXPLORER 样式;否则，该方法将失败并断言。

仅当正在显示的对话框时，可以调用此方法。 关闭该对话框后，此函数将不再起作用，并该方法将使用一个断言失败。

##  <a name="getifiledialogcustomize"></a>  CFileDialog::GetIFileDialogCustomize

检索指向内部 COM 对象的给定[CFileDialog](../../mfc/reference/cfiledialog-class.md)。

```
IFileDialogCustomize* GetIFileDialogCustomize();
```

### <a name="return-value"></a>返回值

为内部的 COM 对象的指针`CFileDialog`。 它由你负责适当地释放该指针。

### <a name="remarks"></a>备注

使用此函数仅在 Windows Vista 或更高版本使用的对象具有*bVistaStyle*设置为 TRUE。 如果您使用此函数时*bVistaStyle*为 FALSE 时，它将在发布模式下返回 NULL 并在调试模式下引发断言。

有关详细信息`IFileDialogCustomize`接口，请参阅[IFileDialogCustomize](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ifiledialogcustomize)。

### <a name="example"></a>示例

此示例检索内部的 COM 对象。 若要运行此代码示例，您必须在 Windows Vista 或更高版本编译它。

[!code-cpp[NVC_MFC_CFileDialog#4](../../mfc/reference/codesnippet/cpp/cfiledialog-class_4.cpp)]

##  <a name="getifileopendialog"></a>  CFileDialog::GetIFileOpenDialog

检索指向内部 COM 对象的给定`CFileDialog`。

```
IFileOpenDialog* GetIFileOpenDialog();
```

### <a name="return-value"></a>返回值

为内部的 COM 对象的指针`CFileDialog`。 它由你负责适当地释放该指针。

### <a name="remarks"></a>备注

使用此函数仅在 Windows Vista 或更高版本使用的对象具有*bVistaStyle*设置为 TRUE。 如果此函数将返回 NULL`CFileDialog`不是**开放**对话框的或者如果*bVistaStyle*设置为 FALSE。 在此最后一种情况下，此函数仅返回了 NULL 在发布模式下-在调试模式下，将引发断言。

有关详细信息`IFileOpenDialog`接口，请参阅[IFileOpenDialog](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ifileopendialog)。

### <a name="example"></a>示例

此示例检索内部的 COM 对象。 若要运行此代码，您必须在 Windows Vista 或更高版本编译它。

[!code-cpp[NVC_MFC_CFileDialog#2](../../mfc/reference/codesnippet/cpp/cfiledialog-class_5.cpp)]

##  <a name="getifilesavedialog"></a>  CFileDialog::GetIFileSaveDialog

检索指向内部 COM 对象的给定`CFileDialog`。

```
IFileSaveDialog* GetIFileSaveDialog();
```

### <a name="return-value"></a>返回值

为内部的 COM 对象的指针`CFileDialog`。 它由你负责适当地释放该指针。

### <a name="remarks"></a>备注

使用此函数仅在 Windows Vista 或更高版本使用的对象具有*bVistaStyle*设置为 TRUE。 如果此函数将返回 NULL`CFileDialog`不是**保存**对话框的或者如果*bVistaStyle*设置为 FALSE。 在此最后一种情况下，此函数仅返回了 NULL 在发布模式下-在调试模式下，将引发断言。

有关详细信息`IFileSaveDialog`接口，请参阅[IFileSaveDialog](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ifilesavedialog)。

### <a name="example"></a>示例

此示例检索内部的 COM 对象。 若要运行此代码示例，您必须在 Windows Vista 或更高版本编译它。

[!code-cpp[NVC_MFC_CFileDialog#3](../../mfc/reference/codesnippet/cpp/cfiledialog-class_6.cpp)]

##  <a name="getnextpathname"></a>  CFileDialog::GetNextPathName

调用此函数可从对话框中选择的组中检索的下一个文件名。

```
CString GetNextPathName(POSITION& pos) const;
```

### <a name="parameters"></a>参数

*pos*<br/>
对先前返回的位置值的引用`GetNextPathName`或`GetStartPosition`函数调用。 如果已到达列表的末尾，则为 NULL。

### <a name="return-value"></a>返回值

文件的完整路径。

### <a name="remarks"></a>备注

文件名的路径包括文件的标题以及整个目录路径。 例如，`GetNextPathName`将返回"C:\FILES\TEXT。DAT"C:\FILES\TEXT.DAT 的文件。 可以使用`GetNextPathName`如果建立调用一次的初始位置的向前迭代循环中`GetStartPosition`。

如果所选内容包含一个文件，将返回该文件的名称。

##  <a name="getofn"></a>  CFileDialog::GetOFN

检索关联`OPENFILENAME`结构。

```
const OPENFILENAME& GetOFN() const;

OPENFILENAME& GetOFN();
```

### <a name="return-value"></a>返回值

[OPENFILENAME](/windows/desktop/api/commdlg/ns-commdlg-tagofna)结构。

### <a name="remarks"></a>备注

使用此函数的第二个版本来初始化的外观**文件打开**或**另存为文件**构造它之后，但之前该脚本显示对话框`DoModal`成员函数。 例如，可以设置`lpstrTitle`的成员`m_ofn`想对话框具有到链接的标题。

##  <a name="getpathname"></a>  CFileDialog::GetPathName

调用此函数可检索对话框框中输入的文件的完整路径。

```
CString GetPathName() const;
```

### <a name="return-value"></a>返回值

文件的完整路径。

### <a name="remarks"></a>备注

文件名的路径包括文件的标题以及整个目录路径。 例如，`GetPathName`将返回"C:\FILES\TEXT。DAT"C:\FILES\TEXT.DAT 的文件。

如果`m_ofn.Flags`OFN_ALLOWMULTISELECT 标志设置，此字符串包含一个序列的 null teminated 被选中，该文件组的目录路径的第一个字符串的字符串后, 跟由用户选择的所有文件的名称。 出于此原因，使用[GetStartPosition](#getstartposition)并[GetNextPathName](#getnextpathname)成员函数以检索列表中的下一个文件名。

### <a name="example"></a>示例

  有关示例，请参阅[CFileDialog::DoModal](#domodal)。

##  <a name="getreadonlypref"></a>  CFileDialog::GetReadOnlyPref

调用此函数可确定是否已在 Windows 标准文件打开和文件另存为对话框框中选定只读复选框。

```
BOOL GetReadOnlyPref() const;
```

### <a name="return-value"></a>返回值

非零的对话框中的只读复选框处于选中状态如果否则为 0。

### <a name="remarks"></a>备注

您可以通过设置 OFN_HIDEREADONLY 样式隐藏只读复选框`CFileDialog`构造函数。

> [!NOTE]
> Windows Vista 或更高版本的样式`CFileDialog`对象不支持此函数。 尝试使用此函数在 Windows Vista 或更高版本的样式`CFileDialog`将引发[CNotSupportedException](../../mfc/reference/cnotsupportedexception-class.md)。

##  <a name="getresult"></a>  CFileDialog::GetResult

检索用户在对话框中所做的选择。

```
IShellItem* GetResult() throw();
```

### <a name="return-value"></a>返回值

表示用户的选择 IShellItem 指向的指针。

### <a name="remarks"></a>备注

##  <a name="getresults"></a>  CFileDialog::GetResults

检索在一个对话框，允许多个选择中的用户的选择。

```
IShellItemArray* GetResults() throw();
```

### <a name="return-value"></a>返回值

可以通过其访问对话框中选定的项 IShellItemArray 指向的指针。

### <a name="remarks"></a>备注

##  <a name="getselectedcontrolitem"></a>  CFileDialog::GetSelectedControlItem

从对话框中指定的容器控件中检索特定项。

```
HRESULT GetSelectedControlItem(
    DWORD dwIDCtl,
    DWORD& dwIDItem);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
容器控件的 ID。

*dwIDItem*<br/>
用户控件中选定的项的 ID。

### <a name="remarks"></a>备注

##  <a name="getstartposition"></a>  CFileDialog::GetStartPosition

如果调用此成员函数以检索在列表中，第一个文件路径名称的位置`m_ofn.Flags`OFN_ALLOWMULTISELECT 标志设置。

```
POSITION GetStartPosition() const;
```

### <a name="return-value"></a>返回值

一个位置值，可以用于迭代;如果列表为空，则为 NULL。

##  <a name="hidecontrol"></a>  CFileDialog::HideControl

调用此成员函数以隐藏在资源管理器样式打开或另存为的通用对话框中指定的控件。

```
void HideControl(int nID);
```

### <a name="parameters"></a>参数

*nID*<br/>
若要隐藏的控件 ID。

### <a name="remarks"></a>备注

必须为对话框中创建的 OFN_EXPLORER 样式;否则，该函数将失败并断言。

##  <a name="ispickfoldersmode"></a>  CFileDialog::IsPickFoldersMode

确定当前对话框是否在文件夹选取器模式下。

```
BOOL IsPickFoldersMode() const;
```

### <a name="return-value"></a>返回值

如果对话框在文件夹选取器模式，则为 TRUE否则为 FALSE。

### <a name="remarks"></a>备注

##  <a name="m_ofn"></a>  CFileDialog::m_ofn

`m_ofn` 是一种类型的结构`OPENFILENAME`。 此结构中的数据表示的当前状态`CFileDialog`。

### <a name="remarks"></a>备注

使用此结构初始化的外观**文件打开**或**另存为文件**对话框，在构造之后但在显示其与之前[DoModal](#domodal)方法。 例如，可以设置*lpstrTitle*的成员`m_ofn`想对话框具有到链接的标题。

与 Windows Vista 或更高版本的样式[CFileDialog](../../mfc/reference/cfiledialog-class.md)，`m_ofn`不能保证始终匹配对话框的状态。 它被同步在早期版本的 Windows 对话框。 请参阅[CFileDialog::ApplyOFNToShellDialog](#applyofntoshelldialog)并[CFileDialog::UpdateOFNFromShellDialog](#updateofnfromshelldialog)有关同步的详细信息`m_ofn`结构和`CFileDialog`状态Windows vista 或更高版本。

Windows Vista 或更高版本的样式文件对话框不支持某些成员和标志的`CFileDialog`。 因此，这些不会影响。

以下是 Windows vista 或更高版本不支持的成员的列表：

- `lpstrCustomFilter`

- `lpstrInitialDir`

- `lCustData`

- `lpfnHook`

- `lpTemplateName`

以下标志不受支持，因此不会影响您使用 Windows Vista 或更高版本的样式`CFileDialog`:

- OFN_ENABLEHOOK

- OFN_ENABLEINCLUDENOTIFY

- OFN_ENABLETEMPLATE

- OFN_ENABLETEMPLATEHANDLE

- OFN_EXPLORER

- OFN_EXTENSIONDIFFERENT

- OFN_HIDEREADONLY

- OFN_LONGNAMES-始终有效地在 Windows Vista 或更高版本

- OFN_NOLONGNAMES-始终有效地关闭 Windows Vista 或更高版本

- OFN_NONETWORKBUTTON-始终有效地在 Windows Vista 或更高版本

- OFN_READONLY

- OFN_SHOWHELP

有关此结构的详细信息，请参阅[OPENFILENAME](/windows/desktop/api/commdlg/ns-commdlg-tagofna) Windows SDK 中的结构。

##  <a name="makeprominent"></a>  CFileDialog::MakeProminent

位置的控件在对话框中，以便它更醒目相比于其他控件。

```
HRESULT MakeProminent(DWORD dwIDCtl);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
控件的 ID。

### <a name="remarks"></a>备注

##  <a name="onbuttonclicked"></a>  CFileDialog::OnButtonClicked

当单击该按钮时调用。

```
virtual void OnButtonClicked(DWORD dwIDCtl);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
按钮的 ID。

### <a name="remarks"></a>备注

##  <a name="oncheckbuttontoggled"></a>  CFileDialog::OnCheckButtonToggled

选中或取消选中复选框时调用。

```
virtual void OnCheckButtonToggled(
    DWORD dwIDCtl,
    BOOL bChecked);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
复选框的 ID。

*bChecked*<br/>
选中或取消选中。

### <a name="remarks"></a>备注

##  <a name="oncontrolactivating"></a>  CFileDialog::OnControlActivating

激活控件时调用。

```
virtual void OnControlActivating(DWORD dwIDCtl);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
控件的 ID。

### <a name="remarks"></a>备注

##  <a name="onfilenamechange"></a>  CFileDialog::OnFileNameChange

如果你想要处理 WM_NOTIFY CDN_SELCHANGE 消息重写此方法。

```
virtual void OnFileNameChange();
```

### <a name="remarks"></a>备注

在用户的文件列表中选择新文件或文件夹时，系统会发送 CDN_SELCHANGE 消息**开放**或**另存为**对话框。 如果你想要在响应此消息中执行任何操作，重写此方法。

仅当对话框的已创建具有开启了 OFN_EXPLORER 标志，系统会发送此消息。 有关通知的详细信息，请参阅[CDN_SELCHANGE](/windows/desktop/dlgbox/cdn-selchange)。 有关 OFN_EXPLORER 标志的信息，请参阅[OPENFILENAME](/windows/desktop/api/commdlg/ns-commdlg-tagofna)结构并[打开和保存为对话框](/windows/desktop/dlgbox/open-and-save-as-dialog-boxes)。

##  <a name="onfilenameok"></a>  CFileDialog::OnFileNameOK

仅当你想要提供自定义验证的通用文件对话框中输入的文件名，重写此函数。

```
virtual BOOL OnFileNameOK();
```

### <a name="return-value"></a>返回值

文件名不是有效的文件名; 如果为 1否则为 0。

### <a name="remarks"></a>备注

此函数，可为任何特定于应用程序的原因拒绝文件名。 通常情况下，不需要使用此函数，因为框架提供的文件名的默认验证并显示一个消息框，如果输入无效的文件名。

如果返回 1，则对话框将一直保留用户输入另一个文件名为显示。 如果返回为 0，对话框过程将关闭该对话框。 其他非零返回值是当前保留，不应。

##  <a name="onfolderchange"></a>  CFileDialog::OnFolderChange

重写此函数以处理 WM_NOTIFYCDN_FOLDERCHANGE 消息。

```
virtual void OnFolderChange();
```

### <a name="remarks"></a>备注

在打开或另存为对话框中打开一个新的文件夹时发送通知消息。

仅当使用 OFN_EXPLORER 样式创建对话框中，会发送通知。 有关通知的详细信息，请参阅[CDN_FOLDERCHANGE](/windows/desktop/dlgbox/cdn-folderchange)。 OFN_EXPLORER 样式有关的信息，请参阅[OPENFILENAME](/windows/desktop/api/commdlg/ns-commdlg-tagofna)结构并[打开和保存为对话框](/windows/desktop/dlgbox/open-and-save-as-dialog-boxes)。

##  <a name="oninitdone"></a>  CFileDialog::OnInitDone

重写此函数以处理 WM_NOTIFY CDN_INITDONE 消息。

```
virtual void OnInitDone();
```

### <a name="remarks"></a>备注

当系统完成排列中的控件时，系统会发送此通知消息**开放**或**另存为**对话框的子对话框中的控件留出空间。

系统将此发送仅当对话框的创建使用 OFN_EXPLORER 样式。 有关通知的详细信息，请参阅[CDN_INITDONE](/windows/desktop/dlgbox/cdn-initdone)。 OFN_EXPLORER 样式有关的信息，请参阅[OPENFILENAME](/windows/desktop/api/commdlg/ns-commdlg-tagofna)结构并[打开和保存为对话框](/windows/desktop/dlgbox/open-and-save-as-dialog-boxes)。

> [!NOTE]
> Windows Vista 或更高版本的样式文件对话框不支持此函数。 尝试在 Windows Vista 或更高版本的样式文件对话框上使用此函数将引发[CNotSupportedException](../../mfc/reference/cnotsupportedexception-class.md)。

##  <a name="onitemselected"></a>  CFileDialog::OnItemSelected

选择容器项时调用。

```
virtual void OnItemSelected(
    DWORD dwIDCtl,
    DWORD dwIDItem);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
容器控件的 ID。

*dwIDItem*<br/>
项的 ID。

### <a name="remarks"></a>备注

##  <a name="onlbselchangednotify"></a>  CFileDialog::OnLBSelChangedNotify

每当在列表框中的当前选定内容即将更改时调用此函数。

```
virtual void OnLBSelChangedNotify(
    UINT nIDBox,
    UINT iCurSel,
    UINT nCode);
```

### <a name="parameters"></a>参数

*nIDBox*<br/>
列表框或组合框选择在其中发生的 ID。

*iCurSel*<br/>
当前所选内容的索引。

*nCode*<br/>
控件通知代码。 此参数必须具有以下值之一：

- 指定 CD_LBSELCHANGE *iCurSel*是单选列表框中选定的项。

- 指定 CD_LBSELSUB *iCurSel*多选列表框中将不再选择。

- 指定 CD_LBSELADD *iCurSel*多选列表框中选择。

- CD_LBSELNOITEMS 指定任何选择存在于多选列表框。

### <a name="remarks"></a>备注

重写此函数可提供自定义处理的选择列表框中会有所变化。 例如，可以使用此函数以显示的访问权限或日期的上次修改的每个文件在用户选择。

##  <a name="onshareviolation"></a>  CFileDialog::OnShareViolation

重写此函数可提供共享冲突的自定义处理。

```
virtual UINT OnShareViolation(LPCTSTR lpszPathName);
```

### <a name="parameters"></a>参数

*lpszPathName*<br/>
发生共享冲突的文件的路径。

### <a name="return-value"></a>返回值

以下值之一：

- 从对话框返回 OFN_SHAREFALLTHROUGH 文件名。

- 操作不需要执行进一步的 OFN_SHARENOWARN 否。

- OFN_SHAREWARN 用户接收此错误的标准警告消息。

### <a name="remarks"></a>备注

通常情况下，不需要使用此函数，因为框架提供了默认的共享冲突的检查，并显示一个消息框，如果发生共享冲突。

如果你想要禁用共享的冲突检查，使用按位 OR 运算符组合的标志 OFN_SHAREAWARE 与`m_ofn.Flags`。

##  <a name="ontypechange"></a>  CFileDialog::OnTypeChange

重写此函数以处理 WM_NOTIFYCDN_TYPECHANGE 消息。

```
virtual void OnTypeChange();
```

### <a name="remarks"></a>备注

当用户选择从列表中打开的文件类型的新文件类型或另存为对话框的发送通知消息。

仅当使用 OFN_EXPLORER 样式创建对话框中，会发送通知。 有关通知的详细信息，请参阅[CDN_TYPECHANGE](/windows/desktop/dlgbox/cdn-typechange)。 OFN_EXPLORER 样式有关的信息，请参阅[OPENFILENAME](/windows/desktop/api/commdlg/ns-commdlg-tagofna)结构并[打开和保存为对话框](/windows/desktop/dlgbox/open-and-save-as-dialog-boxes)。

##  <a name="removecontrolitem"></a>  CFileDialog::RemoveControlItem

从对话框中的容器控件中移除的项。

```
HRESULT RemoveControlItem(
    DWORD dwIDCtl,
    DWORD dwIDItem);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
要删除的项的容器控件的 ID。

*dwIDItem*<br/>
项的 ID。

### <a name="remarks"></a>备注

##  <a name="setcheckbuttonstate"></a>  CFileDialog::SetCheckButtonState

在对话框中设置复选按钮 （复选框） 的当前的状态。

```
HRESULT SetCheckButtonState(
    DWORD dwIDCtl,
    BOOL bChecked);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
复选框的 ID。

*bChecked*<br/>
复选框的状态。 TRUE 表示选中;FALSE 表示选中此项。

### <a name="remarks"></a>备注

##  <a name="setcontrolitemstate"></a>  CFileDialog::SetControlItemState

设置在对话框中找到容器控件中项的当前状态。

```
HRESULT SetControlItemState(
    DWORD dwIDCtl,
    DWORD dwIDItem,
    CDCONTROLSTATEF dwState);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
容器控件的 ID。

*dwIDItem*<br/>
项的 ID。

*dwState*<br/>
一个或多个来自 CDCONTROLSTATE 枚举值，指示该控件的新状态。

### <a name="remarks"></a>备注

##  <a name="setcontrolitemtext"></a>  CFileDialog::SetControlItemText

设置控件项的文本。 例如，附带的单选按钮或菜单中的项的文本。

```
HRESULT SetControlItemText(
    DWORD dwIDCtl,
    DWORD dwIDItem,
    const CString& strLabel);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
容器控件的 ID。

*dwIDItem*<br/>
项的 ID。

*strLabel*<br/>
项的文本。

### <a name="remarks"></a>备注

##  <a name="setcontrollabel"></a>  CFileDialog::SetControlLabel

设置按钮文本或编辑框标签等控件，与关联的文本。

```
HRESULT SetControlLabel(
    DWORD dwIDCtl,
    const CString& strLabel);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
控件的 ID。

*strLabel*<br/>
控件名称。

### <a name="remarks"></a>备注

##  <a name="setcontrolstate"></a>  CFileDialog::SetControlState

设置当前可见性，并已启用的给定控件的状态。

```
HRESULT SetControlState(
    DWORD dwIDCtl,
    CDCONTROLSTATEF dwState);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
控件的 ID。

*dwState*<br/>
一个或多个来自 CDCONTROLSTATE 枚举值，指示该控件的当前状态。

### <a name="remarks"></a>备注

##  <a name="setcontroltext"></a>  CFileDialog::SetControlText

调用此方法以在资源管理器样式中设置指定控件的文本**开放**或**另存为**对话框。

```
void SetControlText(
    int nID,
    LPCSTR lpsz);

void SetControlText(
    int nID,
    const wchar_t *lpsz);
```

### <a name="parameters"></a>参数

*nID*<br/>
[in]为其设置的文本的控件的 ID。

*lpsz*<br/>
[in]指向包含要为控件设置文本的字符串的指针。

### <a name="remarks"></a>备注

此函数的两个版本均有效使用 Unicode 的应用程序。 但是，仅具有 LPCSTR 类型的版本是有效的使用 ANSI 的应用程序。

若要使用此方法，必须使用 OFN_EXPLORER 样式创建对话框。 否则，该函数将失败并断言。

##  <a name="setdefext"></a>  CFileDialog::SetDefExt

调用此函数可设置样式资源管理器中打开或另存为的通用对话框的默认文件扩展名。

```
void SetDefExt(LPCSTR lpsz);
```

### <a name="parameters"></a>参数

*lpsz*<br/>
指向包含要使用的对话框对象的默认扩展名的字符串的指针。 此字符串不得包含句点 （.）。

### <a name="remarks"></a>备注

必须为对话框中创建的 OFN_EXPLORER 样式;否则，该函数将失败并断言。

##  <a name="seteditboxtext"></a>  CFileDialog::SetEditBoxText

在编辑框控件中设置的当前文本。

```
HRESULT SetEditBoxText(
    DWORD dwIDCtl,
    const CString& strText);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
编辑框的 ID。

*strText*<br/>
文本值。

### <a name="remarks"></a>备注

##  <a name="setproperties"></a>  CFileDialog::SetProperties

提供一个属性存储，它定义将默认值用于正在保存的项。

```
BOOL SetProperties(LPCWSTR lpszPropList);
```

### <a name="parameters"></a>参数

*lpszPropList*<br/>
由“;”分隔的预定义的属性列表。 标志的列表，请参阅**标志**一部分[OPENFILENAME](/windows/desktop/api/commdlg/ns-commdlg-tagofna)。

### <a name="remarks"></a>备注

##  <a name="setselectedcontrolitem"></a>  CFileDialog::SetSelectedControlItem

选项按钮组或在对话框中找到一个组合框中设置特定项的选定的状态。

```
HRESULT SetSelectedControlItem(
    DWORD dwIDCtl,
    DWORD dwIDItem);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
容器控件的 ID。

*dwIDItem*<br/>
用户控件中选定的项的 ID。

### <a name="remarks"></a>备注

##  <a name="settemplate"></a>  CFileDialog::SetTemplate

设置的对话框模板[CFileDialog](../../mfc/reference/cfiledialog-class.md)对象。

```
void SetTemplate(
    UINT nWin3ID,
    UINT nWin4ID);

void SetTemplate(
    LPCTSTR lpWin3ID,
    LPCTSTR lpWin4ID);
```

### <a name="parameters"></a>参数

*nWin3ID*<br/>
[in]包含在非-资源管理器的模板资源的 ID 号`CFileDialog`对象。 仅用于 Windows NT 3.51 或不存在 OFN_EXPLORER 样式时使用此模板。

*nWin4ID*<br/>
[in]资源管理器中包含的模板资源的 ID 号`CFileDialog`对象。 仅在 Windows NT 4.0 和更高版本、 Windows 95 和更高版本，或存在 OFN_EXPLORER 样式时使用此模板。

*lpWin3ID*<br/>
[in]包含在非-资源管理器模板资源的名称`CFileDialog`对象。 仅用于 Windows NT 3.51 或不存在 OFN_EXPLORER 样式时使用此模板。

*lpWin4ID*<br/>
[in]包含在资源管理器的模板资源名称`CFileDialog`对象。 仅在 Windows NT 4.0 和更高版本、 Windows 95 和更高版本，或存在 OFN_EXPLORER 样式时使用此模板。

### <a name="remarks"></a>备注

系统将使用指定的模板之一。 系统将确定要使用哪个模板基于 OFN_EXPLORER 样式和应用程序运行的操作系统存在。 通过指定的非资源管理器和资源管理器样式模板，很容易地支持 Windows NT 3.51、 Windows NT 4.0 和更高版本和 Windows 95 和更高版本。

> [!NOTE]
> Windows Vista 或更高版本的样式文件对话框不支持此函数。 尝试在 Windows Vista 或更高版本的样式文件对话框使用此函数将引发[CNotSupportedException](../../mfc/reference/cnotsupportedexception-class.md)。 一种替代方法是使用自定义的对话框。 有关使用自定义详细信息`CFileDialog`，请参阅[IFileDialogCustomize](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ifiledialogcustomize)。

##  <a name="startvisualgroup"></a>  CFileDialog::StartVisualGroup

在对话框中将 visual 组声明。 对任何"add"方法的后续调用将这些元素添加到此组。

```
HRESULT StartVisualGroup(
    DWORD dwIDCtl,
    const CString& strLabel);
```

### <a name="parameters"></a>参数

*dwIDCtl*<br/>
可视化组的 ID。

*strLabel*<br/>
组名称。

### <a name="remarks"></a>备注

##  <a name="updateofnfromshelldialog"></a>  CFileDialog::UpdateOFNFromShellDialog

更新`m_ofn`的数据结构[CFileDialog](../../mfc/reference/cfiledialog-class.md)基于内部对象的当前状态。

```
void UpdateOFNFromShellDialog();
```

### <a name="remarks"></a>备注

在 Windows Vista，该成员之前的 Windows 版本[OPENFILENAME](https://msdn.microsoft.com/library/ms911906.aspx)持续的状态同步数据结构`CFileDialog`。 对任何更改[m_ofn](#m_ofn)成员变量直接影响对话框的状态。 此外，对对话框中的状态的任何更改立即更新 m_ofn 成员变量。

在 Windows Vista 或更高版本，`m_ofn`数据结构不会自动更新。 若要保证中的数据的准确性`m_ofn`成员变量，则应调用`UpdateOFNFromShellDialog`之前访问的数据的函数。 Windows 将调用此函数会自动处理期间[IFileDialog::OnFileOK](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ifiledialogevents-onfileok)。

有关如何使用详细信息`CFileDialog`类在 Windows Vista 或更高版本，请参阅[CFileDialog 类](../../mfc/reference/cfiledialog-class.md)。

### <a name="example"></a>示例

此示例将更新`CFileDialog`之前显示它。 在更新前`m_ofn`成员变量中，我们需要以使其为对话框中的当前状态同步。

[!code-cpp[NVC_MFC_CFileDialog#1](../../mfc/reference/codesnippet/cpp/cfiledialog-class_7.cpp)]

## <a name="see-also"></a>请参阅

[CCommonDialog 类](../../mfc/reference/ccommondialog-class.md)<br/>
[层次结构图](../../mfc/hierarchy-chart.md)
