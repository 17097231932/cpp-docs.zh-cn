---
title: CMFCToolBarMenuButton 类
ms.date: 11/04/2016
f1_keywords:
- CMFCToolBarMenuButton
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::CMFCToolBarMenuButton
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::CompareWith
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::CopyFrom
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::CreateFromMenu
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::CreateMenu
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::CreatePopupMenu
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::EnableQuickCustomize
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::GetCommands
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::GetImageRect
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::GetPaletteRows
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::GetPopupMenu
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::HasButton
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::HaveHotBorder
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::IsBorder
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::IsClickedOnMenu
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::IsDroppedDown
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::IsEmptyMenuAllowed
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::IsExclusive
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::IsMenuPaletteMode
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::IsQuickMode
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::IsTearOffMenu
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::OnAfterCreatePopupMenu
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::OnBeforeDrag
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::OnCalculateSize
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::OnCancelMode
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::OnChangeParentWnd
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::OnClick
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::OnClickMenuItem
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::OnContextHelp
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::OnDraw
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::OnDrawOnCustomizeList
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::OpenPopupMenu
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::ResetImageToDefault
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::SaveBarState
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::Serialize
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::SetACCData
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::SetMenuOnly
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::SetMenuPaletteMode
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::SetMessageWnd
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::SetRadio
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::SetTearOff
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::DrawDocumentIcon
- AFXTOOLBARMENUBUTTON/CMFCToolBarMenuButton::m_bAlwaysCallOwnerDraw
helpviewer_keywords:
- CMFCToolBarMenuButton [MFC], CMFCToolBarMenuButton
- CMFCToolBarMenuButton [MFC], CompareWith
- CMFCToolBarMenuButton [MFC], CopyFrom
- CMFCToolBarMenuButton [MFC], CreateFromMenu
- CMFCToolBarMenuButton [MFC], CreateMenu
- CMFCToolBarMenuButton [MFC], CreatePopupMenu
- CMFCToolBarMenuButton [MFC], EnableQuickCustomize
- CMFCToolBarMenuButton [MFC], GetCommands
- CMFCToolBarMenuButton [MFC], GetImageRect
- CMFCToolBarMenuButton [MFC], GetPaletteRows
- CMFCToolBarMenuButton [MFC], GetPopupMenu
- CMFCToolBarMenuButton [MFC], HasButton
- CMFCToolBarMenuButton [MFC], HaveHotBorder
- CMFCToolBarMenuButton [MFC], IsBorder
- CMFCToolBarMenuButton [MFC], IsClickedOnMenu
- CMFCToolBarMenuButton [MFC], IsDroppedDown
- CMFCToolBarMenuButton [MFC], IsEmptyMenuAllowed
- CMFCToolBarMenuButton [MFC], IsExclusive
- CMFCToolBarMenuButton [MFC], IsMenuPaletteMode
- CMFCToolBarMenuButton [MFC], IsQuickMode
- CMFCToolBarMenuButton [MFC], IsTearOffMenu
- CMFCToolBarMenuButton [MFC], OnAfterCreatePopupMenu
- CMFCToolBarMenuButton [MFC], OnBeforeDrag
- CMFCToolBarMenuButton [MFC], OnCalculateSize
- CMFCToolBarMenuButton [MFC], OnCancelMode
- CMFCToolBarMenuButton [MFC], OnChangeParentWnd
- CMFCToolBarMenuButton [MFC], OnClick
- CMFCToolBarMenuButton [MFC], OnClickMenuItem
- CMFCToolBarMenuButton [MFC], OnContextHelp
- CMFCToolBarMenuButton [MFC], OnDraw
- CMFCToolBarMenuButton [MFC], OnDrawOnCustomizeList
- CMFCToolBarMenuButton [MFC], OpenPopupMenu
- CMFCToolBarMenuButton [MFC], ResetImageToDefault
- CMFCToolBarMenuButton [MFC], SaveBarState
- CMFCToolBarMenuButton [MFC], Serialize
- CMFCToolBarMenuButton [MFC], SetACCData
- CMFCToolBarMenuButton [MFC], SetMenuOnly
- CMFCToolBarMenuButton [MFC], SetMenuPaletteMode
- CMFCToolBarMenuButton [MFC], SetMessageWnd
- CMFCToolBarMenuButton [MFC], SetRadio
- CMFCToolBarMenuButton [MFC], SetTearOff
- CMFCToolBarMenuButton [MFC], DrawDocumentIcon
- CMFCToolBarMenuButton [MFC], m_bAlwaysCallOwnerDraw
ms.assetid: cfa50176-7e4b-4527-9904-86a1b48fc1bc
ms.openlocfilehash: 883d6a9242066289f15e58179a03c4f609699141
ms.sourcegitcommit: fcb48824f9ca24b1f8bd37d647a4d592de1cc925
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/15/2019
ms.locfileid: "69504717"
---
# <a name="cmfctoolbarmenubutton-class"></a>CMFCToolBarMenuButton 类

包含一个弹出菜单的工具栏按钮。
有关更多详细信息, 请参阅位于 Visual Studio 安装的**VC\\atlmfc\\src\\mfc**文件夹中的源代码。

## <a name="syntax"></a>语法

```
class CMFCToolBarMenuButton : public CMFCToolBarButton
```

## <a name="members"></a>成员

### <a name="public-constructors"></a>公共构造函数

|名称|描述|
|----------|-----------------|
|[CMFCToolBarMenuButton::CMFCToolBarMenuButton](#cmfctoolbarmenubutton)|构造 `CMFCToolBarMenuButton` 对象。|

### <a name="public-methods"></a>公共方法

|名称|描述|
|----------|-----------------|
|[CMFCToolBarMenuButton::CompareWith](#comparewith)|将此实例与所提供`CMFCToolBarButton`的对象进行比较。 (重写[CMFCToolBarButton:: seq.comparewith](../../mfc/reference/cmfctoolbarbutton-class.md#comparewith)。)|
|[CMFCToolBarMenuButton::CopyFrom](#copyfrom)|将另一个工具栏按钮的属性复制到当前按钮。 (重写[CMFCToolBarButton:: CopyFrom](../../mfc/reference/cmfctoolbarbutton-class.md#copyfrom)。)|
|[CMFCToolBarMenuButton::CreateFromMenu](#createfrommenu)|通过 Windows 菜单控点初始化工具栏菜单。|
|[CMFCToolBarMenuButton::CreateMenu](#createmenu)|创建一个由工具栏菜单中的命令组成的 Windows 菜单。 返回 Windows 菜单的句柄。|
|[CMFCToolBarMenuButton::CreatePopupMenu](#createpopupmenu)|创建弹出菜单对象 ( [CMFCPopupMenu 类](../../mfc/reference/cmfcpopupmenu-class.md)) 以显示工具栏菜单。|
|[CMFCToolBarMenuButton::EnableQuickCustomize](#enablequickcustomize)||
|[CMFCToolBarMenuButton::GetCommands](#getcommands)|向工具栏菜单中的命令列表提供只读访问权限。|
|[CMFCToolBarMenuButton::GetImageRect](#getimagerect)|检索按钮图像的边框。|
|[CMFCToolBarMenuButton::GetPaletteRows](#getpaletterows)|当菜单处于调色板模式下时, 返回弹出菜单中的行数。|
|[CMFCToolBarMenuButton::GetPopupMenu](#getpopupmenu)|返回一个指向与按钮相关联的弹出菜单对象的指针。|
|[CMFCToolBarMenuButton::HasButton](#hasbutton)||
|[CMFCToolBarMenuButton::HaveHotBorder](#havehotborder)|确定当用户选择按钮时是否显示按钮的边框。 (重写[CMFCToolBarButton:: HaveHotBorder](../../mfc/reference/cmfctoolbarbutton-class.md#havehotborder)。)|
|[CMFCToolBarMenuButton::IsBorder](#isborder)||
|[CMFCToolBarMenuButton::IsClickedOnMenu](#isclickedonmenu)||
|[CMFCToolBarMenuButton::IsDroppedDown](#isdroppeddown)|确定是否显示弹出菜单。|
|[CMFCToolBarMenuButton::IsEmptyMenuAllowed](#isemptymenuallowed)|由框架调用, 用于确定用户是否可以从所选菜单项打开子菜单。|
|[CMFCToolBarMenuButton::IsExclusive](#isexclusive)|确定按钮是否处于独占模式, 即, 即使当用户将指针移到另一个工具栏或按钮上时, 弹出菜单还是保持打开状态。|
|[CMFCToolBarMenuButton::IsMenuPaletteMode](#ismenupalettemode)|确定弹出菜单是否处于调色板模式。|
|[CMFCToolBarMenuButton::IsQuickMode](#isquickmode)||
|[CMFCToolBarMenuButton::IsTearOffMenu](#istearoffmenu)|确定弹出菜单是否有撕条。|
|[CMFCToolBarMenuButton::OnAfterCreatePopupMenu](#onaftercreatepopupmenu)||
|[CMFCToolBarMenuButton::OnBeforeDrag](#onbeforedrag)|指定是否可以拖动该按钮。 (重写[CMFCToolBarButton:: OnBeforeDrag](../../mfc/reference/cmfctoolbarbutton-class.md#onbeforedrag)。)|
|[CMFCToolBarMenuButton::OnCalculateSize](#oncalculatesize)|由框架调用, 用于计算指定设备上下文和停靠状态的按钮大小。 (重写[CMFCToolBarButton:: OnCalculateSize](../../mfc/reference/cmfctoolbarbutton-class.md#oncalculatesize)。)|
|[CMFCToolBarMenuButton::OnCancelMode](#oncancelmode)|由框架调用以处理[WM_CANCELMODE](/windows/win32/winmsg/wm-cancelmode)消息。 (重写[CMFCToolBarButton:: OnCancelMode](../../mfc/reference/cmfctoolbarbutton-class.md#oncancelmode)。)|
|[CMFCToolBarMenuButton::OnChangeParentWnd](#onchangeparentwnd)|在将按钮插入新工具栏时由框架调用。 (重写[CMFCToolBarButton:: OnChangeParentWnd](cmfctoolbarbutton-class.md#onchangeparentwnd)。)|
|[CMFCToolBarMenuButton::OnClick](#onclick)|当用户单击鼠标按钮时由框架调用。 (重写[CMFCToolBarButton:: OnClick](../../mfc/reference/cmfctoolbarbutton-class.md#onclick)。)|
|[CMFCToolBarMenuButton::OnClickMenuItem](#onclickmenuitem)|当用户在弹出菜单中选择某项时由框架调用。|
|[CMFCToolBarMenuButton::OnContextHelp](#oncontexthelp)|当父工具栏处理 WM_HELPHITTEST 消息时由框架调用。 (重写[CMFCToolBarButton:: OnContextHelp](../../mfc/reference/cmfctoolbarbutton-class.md#oncontexthelp)。)|
|[CMFCToolBarMenuButton::OnDraw](#ondraw)|由框架调用, 用于通过使用指定的样式和选项绘制按钮。 (重写[CMFCToolBarButton:: OnDraw](../../mfc/reference/cmfctoolbarbutton-class.md#ondraw)。)|
|[CMFCToolBarMenuButton::OnDrawOnCustomizeList](#ondrawoncustomizelist)|由框架调用, 用于绘制 "**自定义**" 对话框的 "**命令**" 窗格中的按钮。 (重写[CMFCToolBarButton:: OnDrawOnCustomizeList](../../mfc/reference/cmfctoolbarbutton-class.md#ondrawoncustomizelist)。)|
|[CMFCToolBarMenuButton::OpenPopupMenu](#openpopupmenu)|当用户打开弹出菜单时由框架调用。|
|[CMFCToolBarMenuButton::ResetImageToDefault](#resetimagetodefault)|将设置为与按钮关联的图像的默认值。 (重写[CMFCToolBarButton:: ResetImageToDefault](../../mfc/reference/cmfctoolbarbutton-class.md#resetimagetodefault)。)|
|[CMFCToolBarMenuButton::SaveBarState](#savebarstate)|保存工具栏按钮的状态。 (重写[CMFCToolBarButton:: SaveBarState](../../mfc/reference/cmfctoolbarbutton-class.md#savebarstate)。)|
|[CMFCToolBarMenuButton::Serialize](#serialize)|从存档中读取此对象或将其写入存档。 (重写[CMFCToolBarButton:: 串行化](../../mfc/reference/cmfctoolbarbutton-class.md#serialize)。)|
|[CMFCToolBarMenuButton::SetACCData](#setaccdata)|用工具栏按钮`CAccessibilityData`中的可访问性数据填充提供的对象。 (重写[CMFCToolBarButton:: SetACCData](../../mfc/reference/cmfctoolbarbutton-class.md#setaccdata)。)|
|[CMFCToolBarMenuButton::SetMenuOnly](#setmenuonly)|指定是否可以将按钮添加到工具栏中。|
|[CMFCToolBarMenuButton::SetMenuPaletteMode](#setmenupalettemode)|指定弹出菜单是否处于调色板模式。|
|[CMFCToolBarMenuButton::SetMessageWnd](#setmessagewnd)||
|[CMFCToolBarMenuButton::SetRadio](#setradio)|强制工具栏菜单按钮显示一个图标, 指示已选中此图标。|
|[CMFCToolBarMenuButton::SetTearOff](#settearoff)|为弹出菜单指定一个拆卸的栏 ID。|

### <a name="protected-methods"></a>受保护的方法

|名称|描述|
|----------|-----------------|
|[CMFCToolBarMenuButton::DrawDocumentIcon](#drawdocumenticon)|在菜单按钮上绘制图标。|

### <a name="data-members"></a>数据成员

|名称|描述|
|----------|-----------------|
|[CMFCToolBarMenuButton::m_bAlwaysCallOwnerDraw](#m_balwayscallownerdraw)|如果为 TRUE, 则在绘制按钮时, 框架始终调用[CFrameWndEx:: OnDrawMenuImage](../../mfc/reference/cframewndex-class.md#ondrawmenuimage) 。|

## <a name="remarks"></a>备注

`CMFCToolBarMenuButton`可以显示为菜单、具有子菜单的菜单项、执行命令或显示菜单的按钮或只显示菜单的按钮。 通过指定与构造函数`CMFCToolbarMenuButton::CMFCToolbarMenuButton`中的按钮关联的图像、文本、菜单句柄和命令 ID 等参数, 确定菜单按钮的行为和外观。

派生`CMFCToolbarMenuButton`自类的自定义类必须使用[DECLARE_SERIAL](run-time-object-model-services.md#declare_serial)宏。 当应用程序关闭时, [DECLARE_DYNCREATE](run-time-object-model-services.md#declare_dyncreate)宏将生成错误。

## <a name="example"></a>示例

下面的示例演示如何配置`CMFCToolBarMenuButton`对象。 此代码演示了如何指定下拉菜单处于调色板模式, 并指定了在用户将菜单按钮拖离菜单栏时创建的撕分隔条的 ID。 此代码片段属于 [Word Pad 示例](../../overview/visual-cpp-samples.md)。

[!code-cpp[NVC_MFC_WordPad#10](../../mfc/reference/codesnippet/cpp/cmfctoolbarmenubutton-class_1.cpp)]

## <a name="inheritance-hierarchy"></a>继承层次结构

[CObject](cobject-class.md)

[CMFCToolBarButton](../../mfc/reference/cmfctoolbarbutton-class.md)

[CMFCToolBarMenuButton](../../mfc/reference/cmfctoolbarmenubutton-class.md)

## <a name="requirements"></a>要求

**标头：** afxtoolbarmenubutton.h

##  <a name="cmfctoolbarmenubutton"></a>CMFCToolBarMenuButton:: CMFCToolBarMenuButton

构造 `CMFCToolBarMenuButton` 对象。

```
CMFCToolBarMenuButton();
CMFCToolBarMenuButton(const CMFCToolBarMenuButton& src);

CMFCToolBarMenuButton(
    UINT uiID,
    HMENU hMenu,
    int iImage,
    LPCTSTR lpszText=NULL,
    BOOL bUserButton=FALSE);
```

### <a name="parameters"></a>参数

*src*<br/>
中要复制`CMFCToolBarMenuButton`到此`CMFCToolBarMenuButton`对象中的现有对象。

*uiID*<br/>
中用户单击按钮时要执行的命令的 ID;或 (UINT)-1 表示不直接执行命令的菜单按钮。

*hMenu*<br/>
中菜单的句柄;如果按钮没有菜单, 则为 NULL。

*iImage*<br/>
中按钮的图像的索引;如果此按钮没有图标或使用*uiID*指定的命令的图标, 则为-1。 对于应用程序中的每个`CMFCToolBarImages`对象, 索引都是相同的。

*lpszText*<br/>
中工具栏菜单按钮的文本。

*bUserButton*<br/>
中如果按钮显示用户定义的图像, 则为 TRUE;如果按钮显示与*uiID*指定的命令相关联的预定义映像, 则为 FALSE。

### <a name="remarks"></a>备注

如果*uiID*是有效的命令 ID, 则当用户单击该命令时, 该按钮会执行该命令。 如果*hMenu*是有效的菜单控点, 则在菜单中出现工具栏或子菜单时, 该按钮将提供一个下拉菜单。 如果 " *uiID* " 和 " *hMenu* " 都是有效的, 则该按钮是一个带有部分的拆分按钮, 当用户单击该按钮时该命令会执行该命令, 而在用户单击该按钮时, 还会出现一个带有向下箭头的部分。 但是, 如果*hMenu*是有效的, 则在将按钮插入菜单时, 用户将无法单击该按钮来执行命令。

### <a name="example"></a>示例

下面的示例演示如何构造`CMFCToolBarMenuButton`类的对象。 此代码片段属于 [Word Pad 示例](../../overview/visual-cpp-samples.md)。

[!code-cpp[NVC_MFC_WordPad#9](../../mfc/reference/codesnippet/cpp/cmfctoolbarmenubutton-class_2.cpp)]

##  <a name="comparewith"></a>CMFCToolBarMenuButton:: Seq.comparewith

```
virtual BOOL CompareWith(const CMFCToolBarButton& other) const;
```

### <a name="parameters"></a>参数

[in] *other*<br/>

### <a name="return-value"></a>返回值

### <a name="remarks"></a>备注

##  <a name="copyfrom"></a>CMFCToolBarMenuButton:: CopyFrom

```
virtual void CopyFrom(const CMFCToolBarButton& src);
```

### <a name="parameters"></a>参数

[in] *src*<br/>

### <a name="remarks"></a>备注

##  <a name="createfrommenu"></a>CMFCToolBarMenuButton:: CreateFromMenu

通过 Windows 菜单控点初始化工具栏菜单。

```
virtual void CreateFromMenu(HMENU hMenu);
```

### <a name="parameters"></a>参数

*hMenu*<br/>
中菜单的句柄。

### <a name="remarks"></a>备注

工具栏菜单按钮可以显示下拉子菜单。

框架调用此方法来初始化菜单中的子菜单命令。

##  <a name="createmenu"></a>CMFCToolBarMenuButton:: CreateMenu

创建一个菜单, 其中包含工具栏菜单中的命令。 返回菜单的句柄。

```
virtual HMENU CreateMenu() const;
```

### <a name="return-value"></a>返回值

如果成功, 则为菜单的句柄。 如果与工具栏菜单按钮关联的命令列表为空, 则为 NULL。

### <a name="remarks"></a>备注

可以在派生类中重写此方法, 以自定义菜单的生成方式。

##  <a name="createpopupmenu"></a>CMFCToolBarMenuButton:: CreatePopupMenu

创建一个`CMFCPopupMenu`对象以显示工具栏菜单。

```
virtual CMFCPopupMenu* CreatePopupMenu();
```

### <a name="return-value"></a>返回值

指向`CMFCPopupMenu`对象的指针, 该对象显示与工具栏菜单按钮相关联的下拉菜单。

### <a name="remarks"></a>备注

框架调用此方法来准备显示与该按钮关联的下拉菜单。

默认实现仅构造并返回一个新`CMFCPopupMenu`的对象。 如果要使用[CMFCPopupMenu 类](cmfcpopupmenu-class.md)的派生类型或执行其他初始化, 请重写此方法。

##  <a name="drawdocumenticon"></a>CMFCToolBarMenuButton::D rawDocumentIcon

在菜单按钮上绘制文档图标。

```
void DrawDocumentIcon(
    CDC* pDC,
    const CRect& rectImage,
    HICON hIcon);
```

### <a name="parameters"></a>参数

*pDC*<br/>
中指向设备上下文的指针。

*rectImage*<br/>
中图像边框的坐标。

*hIcon*<br/>
中图标的句柄。

### <a name="remarks"></a>备注

此方法采用文档图标, 并将其绘制在菜单按钮上, 并以*rectImage*指定的区域为中心。

##  <a name="enablequickcustomize"></a>CMFCToolBarMenuButton:: EnableQuickCustomize

```
void EnableQuickCustomize();
```

### <a name="remarks"></a>备注

##  <a name="hasbutton"></a>CMFCToolBarMenuButton:: HasButton

```
virtual BOOL HasButton() const;
```

### <a name="return-value"></a>返回值

### <a name="remarks"></a>备注

##  <a name="havehotborder"></a>CMFCToolBarMenuButton:: HaveHotBorder

```
virtual BOOL HaveHotBorder() const;
```

### <a name="return-value"></a>返回值

### <a name="remarks"></a>备注

##  <a name="isborder"></a>CMFCToolBarMenuButton:: IsBorder

```
virtual BOOL IsBorder() const;
```

### <a name="return-value"></a>返回值

### <a name="remarks"></a>备注

##  <a name="isclickedonmenu"></a>CMFCToolBarMenuButton:: IsClickedOnMenu

```
BOOL IsClickedOnMenu() const;
```

### <a name="return-value"></a>返回值

### <a name="remarks"></a>备注

##  <a name="isquickmode"></a>CMFCToolBarMenuButton:: IsQuickMode

```
BOOL IsQuickMode();
```

### <a name="return-value"></a>返回值

### <a name="remarks"></a>备注

##  <a name="getcommands"></a>CMFCToolBarMenuButton:: GetCommands

向工具栏菜单中的命令列表提供只读访问权限。

```
const CObList& GetCommands() const;
```

### <a name="return-value"></a>返回值

对[CObList 类](../../mfc/reference/coblist-class.md)对象的 const 引用, 其中包含[CMFCToolBarButton 类](../../mfc/reference/cmfctoolbarbutton-class.md)对象的集合。

### <a name="remarks"></a>备注

工具栏菜单按钮可以显示子菜单。 可以提供构造函数的子菜单中的命令列表, 或在[CMFCToolBarMenuButton:: CreateFromMenu](#createfrommenu)中提供命令列表作为菜单的句柄 (HMENU)。 菜单将转换为一个对象列表, 这些对象是从[CMFCToolBarButton 类](../../mfc/reference/cmfctoolbarbutton-class.md)派生并存储在内部`CObList`对象中的。 可以通过调用此方法来访问此列表。

##  <a name="getimagerect"></a>CMFCToolBarMenuButton:: GetImageRect

检索按钮图像的边框。

```
void GetImageRect(CRect& rectImage);
```

### <a name="parameters"></a>参数

*rectImage*<br/>
弄`CRect`对象的引用, 该对象接收图像边框的坐标。

##  <a name="getpaletterows"></a>CMFCToolBarMenuButton:: GetPaletteRows

当菜单处于调色板模式下时, 返回下拉菜单中的行数。

```
int GetPaletteRows() const;
```

### <a name="return-value"></a>返回值

调色板中的行数。

### <a name="remarks"></a>备注

当菜单按钮设置为调色板模式时, 菜单项将出现在只有有限行数的多个列中。 调用此方法可获取行数。 可以启用或禁用调色板模式, 并使用[CMFCToolBarMenuButton:: SetMenuPaletteMode](#setmenupalettemode)指定行数。

##  <a name="getpopupmenu"></a>CMFCToolBarMenuButton:: GetPopupMenu

返回一个指向[CMFCPopupMenu 类](../../mfc/reference/cmfcpopupmenu-class.md)对象的指针, 该对象表示按钮的下拉菜单。

```
CMFCPopupMenu* GetPopupMenu() const;
```

### <a name="return-value"></a>返回值

指向[CMFCPopupMenu 类](../../mfc/reference/cmfcpopupmenu-class.md)对象的指针, 该对象是在框架绘制工具栏菜单按钮的子菜单时创建的;如果未显示子菜单, 则为 NULL。

### <a name="remarks"></a>备注

当工具栏菜单按钮显示下拉菜单时, 按钮会创建一个[CMFCPopupMenu 类](../../mfc/reference/cmfcpopupmenu-class.md)对象来表示菜单。 调用此方法以获取指向`CMFCPopupMenu`对象的指针。 不应存储返回的指针, 因为它是临时的, 并且在用户关闭下拉菜单时变为无效。

##  <a name="isdroppeddown"></a>CMFCToolBarMenuButton:: IsDroppedDown

指示当前是否显示弹出菜单。

```
virtual BOOL IsDroppedDown() const;
```

### <a name="return-value"></a>返回值

如果工具栏菜单按钮显示其子菜单, 则为 TRUE;否则为 FALSE。

##  <a name="isemptymenuallowed"></a>CMFCToolBarMenuButton:: IsEmptyMenuAllowed

指定菜单项是否显示空子菜单。

```
virtual BOOL IsEmptyMenuAllowed() const;
```

### <a name="return-value"></a>返回值

如果框架从当前选定的菜单项打开子菜单 (即使子菜单为空), 则为 TRUE;否则为 FALSE。

### <a name="remarks"></a>备注

当用户尝试从当前选定的菜单项打开子菜单时, 框架会调用此方法。 如果子菜单为空并`IsEmptyMenuAllowed`返回 FALSE, 则子菜单将不会打开。

默认实现返回 FALSE。 重写此方法以自定义此行为。

##  <a name="isexclusive"></a>CMFCToolBarMenuButton:: IsExclusive

指示按钮是否处于独占模式。

```
virtual BOOL IsExclusive() const;
```

### <a name="return-value"></a>返回值

如果按钮在独占模式下工作, 则为 TRUE;否则为 FALSE。

### <a name="remarks"></a>备注

当用户打开一个按钮的弹出菜单, 然后将鼠标指针移到另一个工具栏或菜单按钮上时, 弹出菜单将关闭, 除非此按钮处于独占模式。

默认实现始终返回 FALSE。 如果要启用独占模式, 请在派生类中重写此方法。

##  <a name="ismenupalettemode"></a>CMFCToolBarMenuButton:: IsMenuPaletteMode

确定下拉菜单是否处于调色板模式。

```
BOOL IsMenuPaletteMode() const;
```

### <a name="return-value"></a>返回值

如果启用调色板模式, 则为 TRUE; 否则为 FALSE。

### <a name="remarks"></a>备注

当菜单按钮设置为调色板模式时, 菜单项出现在只有有限行数的多个列中。 调用此方法可获取行数。 可以通过调用[CMFCToolBarMenuButton:: SetMenuPaletteMode](#setmenupalettemode)启用或禁用调色板模式。

##  <a name="istearoffmenu"></a>CMFCToolBarMenuButton:: IsTearOffMenu

指示下拉菜单中是否有一个撕条。

```
virtual BOOL IsTearOffMenu() const;
```

### <a name="return-value"></a>返回值

如果工具栏菜单按钮具有撕块, 则为 TRUE;否则为 FALSE。

### <a name="remarks"></a>备注

若要启用撕功能并设置撕号 bar ID, 请调用[CMFCToolBarMenuButton:: SetTearOff](#settearoff)。

##  <a name="m_balwayscallownerdraw"></a>CMFCToolBarMenuButton:: m_bAlwaysCallOwnerDraw

指定在绘制按钮时框架是否始终调用[CFrameWndEx:: OnDrawMenuImage](../../mfc/reference/cframewndex-class.md#ondrawmenuimage) 。

```
static BOOL m_bAlwaysCallOwnerDraw;
```

### <a name="remarks"></a>备注

当此成员变量设置为 TRUE 时, 按钮始终调用[CFrameWndEx:: OnDrawMenuImage](../../mfc/reference/cframewndex-class.md#ondrawmenuimage)方法来显示按钮上的图像。 如果`m_bAlwaysCallOwnerDraw`为 FALSE, 则在预定义图像时, 按钮本身会绘制图像。 否则, 它会`OnDrawMenuImage`调用。

##  <a name="onaftercreatepopupmenu"></a>  CMFCToolBarMenuButton::OnAfterCreatePopupMenu

```
virtual void OnAfterCreatePopupMenu();
```

### <a name="remarks"></a>备注

##  <a name="onbeforedrag"></a>CMFCToolBarMenuButton:: OnBeforeDrag

```
virtual BOOL OnBeforeDrag() const;
```

### <a name="return-value"></a>返回值

### <a name="remarks"></a>备注

##  <a name="oncalculatesize"></a>CMFCToolBarMenuButton:: OnCalculateSize

```
virtual SIZE OnCalculateSize(
    CDC* pDC,
    const CSize& sizeDefault,
    BOOL bHorz);
```

### <a name="parameters"></a>参数

[in] *pDC*<br/>
中*sizeDefault*<br/>
[in] *bHorz*<br/>

### <a name="return-value"></a>返回值

### <a name="remarks"></a>备注

##  <a name="oncancelmode"></a>CMFCToolBarMenuButton:: OnCancelMode

```
virtual void OnCancelMode();
```

### <a name="remarks"></a>备注

##  <a name="onchangeparentwnd"></a>CMFCToolBarMenuButton:: OnChangeParentWnd

```
virtual void OnChangeParentWnd(CWnd* pWndParent);
```

### <a name="parameters"></a>参数

[in] *pWndParent*<br/>

### <a name="remarks"></a>备注

##  <a name="onclick"></a>CMFCToolBarMenuButton:: OnClick

```
virtual BOOL OnClick(
    CWnd* pWnd,
    BOOL bDelay = TRUE);
```

### <a name="parameters"></a>参数

[in] *pWnd*<br/>
[in] *bDelay*<br/>

### <a name="return-value"></a>返回值

### <a name="remarks"></a>备注

##  <a name="onclickmenuitem"></a>CMFCToolBarMenuButton:: OnClickMenuItem

当用户在下拉菜单中选择某项时由框架调用。

```
virtual BOOL OnClickMenuItem();
```

### <a name="return-value"></a>返回值

如果框架应继续处理默认菜单项, 则为 FALSE; 否则为 FALSE。否则为 TRUE。 默认实现始终返回 FALSE。

### <a name="remarks"></a>备注

当用户单击菜单项时, 框架会执行与该项相关联的命令。

若要自定义菜单项处理, `OnClickMenuItem`请在从`CMFCToolBarMenuButton`类派生的类中重写。 还必须重写[CFrameWndEx:: OnShowPopupMenu](../../mfc/reference/cframewndex-class.md#onshowpopupmenu) , 并将需要特殊处理的菜单按钮替换为派生类的实例。

##  <a name="oncontexthelp"></a>CMFCToolBarMenuButton:: OnContextHelp

```
virtual BOOL OnContextHelp(CWnd* pWnd);
```

### <a name="parameters"></a>参数

[in] *pWnd*<br/>

### <a name="return-value"></a>返回值

### <a name="remarks"></a>备注

##  <a name="ondraw"></a>CMFCToolBarMenuButton:: OnDraw

```
virtual void OnDraw(
    CDC* pDC,
    const CRect& rect,
    CMFCToolBarImages* pImages,
    BOOL bHorz = TRUE,
    BOOL bCustomizeMode = FALSE,
    BOOL bHighlight = FALSE,
    BOOL bDrawBorder = TRUE,
    BOOL bGrayDisabledButtons = TRUE);
```

### <a name="parameters"></a>参数

[in] *pDC*<br/>
中*rect*<br/>
中*pImages*<br/>
[in] *bHorz*<br/>
中*bCustomizeMode*<br/>
中*bHighlight*<br/>
[in] *bDrawBorder*<br/>
中*bGrayDisabledButtons*<br/>

### <a name="remarks"></a>备注

##  <a name="ondrawoncustomizelist"></a>CMFCToolBarMenuButton:: OnDrawOnCustomizeList

```
virtual int OnDrawOnCustomizeList(
    CDC* pDC,
    const CRect& rect,
    BOOL bSelected);
```

### <a name="parameters"></a>参数

[in] *pDC*<br/>
中*rect*<br/>
中*bSelected*<br/>

### <a name="return-value"></a>返回值

### <a name="remarks"></a>备注

##  <a name="openpopupmenu"></a>CMFCToolBarMenuButton:: OpenPopupMenu

当用户打开工具栏菜单按钮的下拉菜单时由框架调用。

```
virtual BOOL OpenPopupMenu(CWnd* pWnd=NULL);
```

### <a name="parameters"></a>参数

*pWnd*<br/>
中指定接收下拉菜单命令的窗口。 仅当工具栏菜单按钮具有父窗口时, 它才可为 NULL。

### <a name="return-value"></a>返回值

如果成功创建并打开[CMFCPopupMenu 类](../../mfc/reference/cmfcpopupmenu-class.md)对象, 则为 TRUE;否则为 FALSE。

### <a name="remarks"></a>备注

当用户从工具栏菜单按钮打开下拉菜单时, 框架会调用此函数。

##  <a name="resetimagetodefault"></a>CMFCToolBarMenuButton:: ResetImageToDefault

```
virtual void ResetImageToDefault();
```

### <a name="remarks"></a>备注

##  <a name="savebarstate"></a>CMFCToolBarMenuButton:: SaveBarState

```
virtual void SaveBarState();
```

### <a name="remarks"></a>备注

框架在创建工具栏按钮作为拖放操作的结果时, 将调用此方法。 此方法调用顶级弹出菜单的[CMFCPopupMenu:: SaveState](../../mfc/reference/cmfcpopupmenu-class.md#savestate)方法, 这会导致弹出菜单的父按钮重新创建其菜单。

##  <a name="serialize"></a>CMFCToolBarMenuButton:: 串行化

```
virtual void Serialize(CArchive& ar);
```

### <a name="parameters"></a>参数

[in] *ar*<br/>

### <a name="remarks"></a>备注

##  <a name="setaccdata"></a>CMFCToolBarMenuButton:: SetACCData

设置功能区元素的可访问性数据。

```
virtual BOOL SetACCData(
    CWnd* pParent,
    CAccessibilityData& data);
```

### <a name="parameters"></a>参数

*pParent*<br/>
功能区元素的父窗口。

*data*<br/>
功能区元素的可访问性数据。

### <a name="return-value"></a>返回值

始终返回 TRUE。

### <a name="remarks"></a>备注

默认情况下, 此方法将设置功能区元素的可访问性数据, 并始终返回 TRUE。 重写此方法以设置可访问性数据并返回一个指示成功或失败的值。

##  <a name="setmenuonly"></a>CMFCToolBarMenuButton:: SetMenuOnly

指定按钮在具有有效的命令 ID 和子菜单时是作为菜单按钮还是拆分按钮绘制。

```
void SetMenuOnly(BOOL bMenuOnly);
```

### <a name="parameters"></a>参数

*bMenuOnly*<br/>
中如果为 TRUE, 则当此按钮同时具有有效的命令 ID 和子菜单时将此按钮显示为 "菜单" 按钮, 当它同时具有有效的命令 ID 和子菜单时, 将此按钮显示为拆分按钮。

### <a name="remarks"></a>备注

通常, 当工具栏菜单按钮同时具有子菜单和命令 ID 时, 菜单显示为一个拆分按钮, 该按钮具有主按钮和一个向下箭头按钮。 如果调用此方法并且*bMenuOnly*为 TRUE, 则该按钮将显示为一个菜单按钮, 该按钮上有一个向下箭头。 当用户在任一模式下单击箭头时, 子菜单将打开, 当用户在任一模式下单击按钮的非箭头部分时, 框架会执行该命令。

##  <a name="setmenupalettemode"></a>CMFCToolBarMenuButton:: SetMenuPaletteMode

指定下拉菜单是否处于调色板模式。

```
void SetMenuPaletteMode(
    BOOL bMenuPaletteMode=TRUE,
    int nPaletteRows=1);
```

### <a name="parameters"></a>参数

*bMenuPaletteMode*<br/>
中指定下拉菜单是否处于调色板模式。

*nPaletteRows*<br/>
中调色板中的行数。

### <a name="remarks"></a>备注

在调色板模式下, 所有菜单项都显示为多列调色板。 使用*nPaletteRows*指定行数。

##  <a name="setmessagewnd"></a>CMFCToolBarMenuButton:: SetMessageWnd

```
void SetMessageWnd(CWnd* pWndMessage);
```

### <a name="parameters"></a>参数

[in] *pWndMessage*<br/>

### <a name="remarks"></a>备注

##  <a name="setradio"></a>CMFCToolBarMenuButton:: SetRadio

设置工具栏菜单按钮, 以在选中时显示单选按钮样式图标。

```
virtual void SetRadio();
```

### <a name="remarks"></a>备注

当选中菜单按钮时, 它会调用[CMFCVisualManager:: OnDrawMenuCheck](../../mfc/reference/cmfcvisualmanager-class.md#ondrawmenucheck)来绘制复选标记图标。 默认情况下`OnDrawMenuCheck` , 请求当前视觉对象管理器在菜单按钮上绘制 checkbox 样式复选标记。 调用此方法后, 当前的可视化管理器将在菜单按钮上绘制单选按钮样式的复选标记。 此更改无法撤消。

调用此方法并且菜单按钮当前正在显示时, 它将刷新。

##  <a name="settearoff"></a>CMFCToolBarMenuButton:: SetTearOff

指定下拉菜单的撕号栏的 ID。

```
virtual void SetTearOff(UINT uiBarID);
```

### <a name="parameters"></a>参数

*uiBarID*<br/>
中指定一个新的撕 bar ID。

### <a name="remarks"></a>备注

调用此方法可指定在用户将菜单按钮拖离菜单栏时所创建的脱离栏的 ID。 如果*uiBarID*参数为 0, 则用户不能脱离菜单按钮。

调用[CWinAppEx:: EnableTearOffMenus](../../mfc/reference/cwinappex-class.md#enabletearoffmenus)以在应用程序中启用 "撕开" 菜单功能。

## <a name="see-also"></a>请参阅

[层次结构图](../../mfc/hierarchy-chart.md)<br/>
[类](../../mfc/reference/mfc-classes.md)<br/>
[CMFCToolBarButton 类](../../mfc/reference/cmfctoolbarbutton-class.md)<br/>
[CMFCToolBar 类](../../mfc/reference/cmfctoolbar-class.md)<br/>
[CMFCPopupMenu 类](../../mfc/reference/cmfcpopupmenu-class.md)
